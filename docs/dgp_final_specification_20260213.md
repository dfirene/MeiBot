# DGP 資料治理管理平台 - 最終開發規格書

**版本**: 2.0 Final  
**日期**: 2026-02-13  
**定位**: Web-based 深度分析平台 + 完整 AI 賦能

---

## 📋 需求確認

根據 Irene 的需求：
1. ✅ **只做 Web** - 不需要 Telegram/獨立 Bot
2. ✅ **完整版** - 包含所有 AI 功能
3. ✅ **深度分析 + 複雜操作** - 給人類操作，必須可視化且易用

---

## 🎯 核心設計原則

### 1. 可視化優先 (Visualization First)
**原則**: 複雜的資料和分析結果必須用直觀的圖表呈現

**實踐**:
- ❌ 不要：顯示一大堆數字表格
- ✅ 要做：互動式圖表、趨勢線、熱力圖
- ✅ 要做：顏色編碼（紅黃綠）表示狀態
- ✅ 要做：一眼就能看出問題在哪裡

**範例**:
```
❌ 不好的設計:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Table: vendor_master
Completeness: 87.5%
Issues: 123
Last_check: 2026-02-13 10:00:00
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 好的設計:
┌──────────────────────────────┐
│ 📊 vendor_master             │
│                              │
│    品質評分  87.5%  🟡 GOOD  │
│    ━━━━━━━━━━━━━━━━━━━━━━  │
│    █████████████████▒▒▒▒▒   │
│                              │
│ ⚠️ 123 個問題待處理            │
│                              │
│ [趨勢圖 📈]                   │
│  95% ┐                       │
│      │     ╱─╲               │
│  85% ├────╱   ╲──◄ 目前      │
│      │                       │
│  75% └─────────────          │
│       7天前  今天             │
│                              │
│ [查看詳情] [修復問題]         │
└──────────────────────────────┘
```

---

### 2. 操作簡化 (Simplicity in Action)
**原則**: 複雜的操作用簡單的介面完成

**實踐**:
- ✅ 一鍵式操作（例：一鍵優化、一鍵重試）
- ✅ 智能預填（AI 自動填好參數，使用者只需確認）
- ✅ 引導式流程（分步驟完成複雜任務）
- ✅ 拖拉式配置（不需要寫程式碼）

**範例**:
```
建立品質規則 - 傳統方式:
1. 選擇資料表
2. 選擇欄位
3. 選擇規則類型
4. 填寫條件（正則表達式、SQL 等）
5. 設定嚴重性
6. 設定通知方式
→ 需要 10+ 步驟

建立品質規則 - AI 輔助方式:
1. AI 分析資料後自動建議：
   "發現 tax_number 都是 8 碼數字，要建立格式檢查嗎？"
2. 使用者點擊 [是]
3. AI 自動建立並套用規則
→ 只需 1 個點擊 ✅
```

---

### 3. AI 無縫整合 (Seamless AI Integration)
**原則**: AI 不是獨立功能，而是融入每個操作

**實踐**:
- ✅ 每個頁面都有 AI 助手
- ✅ AI 理解當前上下文（知道使用者在看什麼）
- ✅ AI 主動提供建議（不需要使用者問）
- ✅ AI 可以直接執行操作（經使用者授權）

**範例**:
```
[使用者打開 vendor_master_sync 作業詳情頁]

🤖 AI 自動分析並提示:
┌────────────────────────────────────┐
│ 💡 AI 發現了一些問題                 │
├────────────────────────────────────┤
│ 這個作業最近 5 次執行都很慢(5.2 分鐘) │
│                                    │
│ 主要瓶頸:                           │
│ • SQL 查詢時間過長 (73%)            │
│ • 缺少必要的索引                    │
│                                    │
│ 建議優化:                           │
│ ✓ 建立索引 (預期提升 60%)           │
│ ✓ 調整批次大小                      │
│                                    │
│ [一鍵優化] [查看詳情] [忽略]        │
└────────────────────────────────────┘
```

---

## 🏗️ 系統架構

### 技術棧（確定版）

#### 前端
- **框架**: Vue.js 3 (Composition API)
- **UI 庫**: Ant Design Vue（企業級、美觀、組件豐富）
- **圖表**: 
  - **ECharts** (通用圖表：折線、柱狀、餅圖等)
  - **D3.js** (自訂視覺化：血緣圖、DAG 圖)
  - **vis.js** (網絡圖、時間軸)
- **狀態管理**: Pinia
- **WebSocket**: Socket.io-client

#### 後端
- **運行環境**: Node.js 18+ LTS
- **Web 框架**: Express.js
- **ORM**: Prisma（類型安全、自動遷移）
- **AI 整合**: 
  - Claude API (主要對話、分析)
  - Python FastAPI (ML 模型微服務)
- **排程**: Bull (Redis-based 佇列)
- **即時通訊**: Socket.io

#### 資料庫
- **主資料庫**: PostgreSQL 14+ (AWS RDS)
  - 新建 `dgp` database（應用層）
  - 連接現有 `source` database（讀取 clean schema）
- **快取**: Redis 6+
- **向量資料庫**: pgvector（語意搜尋）

#### AI/ML
- **LLM**: Anthropic Claude (Sonnet 3.5/Opus)
- **ML 框架**: 
  - scikit-learn (異常檢測、分類)
  - statsmodels (時間序列、預測)
- **NLP**: 自然語言處理（意圖識別）

---

## 📊 詳細功能設計

### 模組 1: 智能儀表板

#### 1.1 系統總覽
```
┌─────────────────────────────────────────────────────┐
│  📊 系統概覽                    [刷新] [自訂配置]     │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────┐│
│  │ 資料源    │ │ ETL 作業  │ │ 資料品質  │ │ 今日量 ││
│  │          │ │          │ │          │ │        ││
│  │  12/15   │ │  45/50   │ │  95.2%  │ │  1.2M  ││
│  │  🟢 80%  │ │  🟢 90%  │ │  🟢 優秀  │ │  +5%   ││
│  │          │ │          │ │          │ │        ││
│  │ [詳情]   │ │ [詳情]   │ │ [詳情]   │ │ [詳情] ││
│  └──────────┘ └──────────┘ └──────────┘ └────────┘│
│                                                      │
├─────────────────────────────────────────────────────┤
│  📈 即時監控                                          │
│                                                      │
│  ┌──────────────────────────┐ ┌──────────────────┐ │
│  │ ETL 執行趨勢 (24小時)      │ │ 品質分數趨勢(7天)│ │
│  │                          │ │                  │ │
│  │  [互動式折線圖]           │ │  [互動式折線圖]  │ │
│  │  - 滑鼠懸停顯示詳情        │ │  - 點擊深入查看  │ │
│  │  - 可縮放時間範圍          │ │  - 多資料表對比  │ │
│  │                          │ │                  │ │
│  └──────────────────────────┘ └──────────────────┘ │
│                                                      │
├─────────────────────────────────────────────────────┤
│  🚨 告警中心        │  📋 最近執行                    │
│                    │                                │
│  🔴 3 個嚴重告警    │  ✅ material_master_sync       │
│  🟡 5 個警告        │     2 分鐘前 · 成功 · 1,348 rows│
│  🔵 2 個資訊        │                                │
│                    │  ❌ vendor_master_sync         │
│  [查看全部]        │     30 分鐘前 · 失敗 · Timeout │
│                    │     [重試] [查看日誌]          │
│                    │                                │
│                    │  [查看全部執行記錄]            │
└────────────────────┴────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│  💬 AI 助手                            [最小化] [×]  │
├─────────────────────────────────────────────────────┤
│  🤖: 早安 Irene！今天有 2 個需要關注的項目：         │
│                                                      │
│     1. vendor_master_sync 失敗了                    │
│        → 已自動重試，需要您確認                      │
│                                                      │
│     2. vendor_master 品質下降 2%                    │
│        → 發現 78 rows 格式問題                       │
│                                                      │
│     需要我協助處理嗎？                               │
│                                                      │
│  ┌──────────────────────────────────────────────┐  │
│  │ 問我任何問題... (Ctrl+K 快速呼叫)             │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**互動特性**:
- 所有卡片可點擊深入查看
- 圖表支援縮放、篩選、匯出
- AI 助手可最小化到右下角
- 按 `Ctrl+K` 快速呼叫 AI

---

#### 1.2 AI 助手面板（詳細）

**位置**: 右下角常駐，可展開/收起

**展開狀態**:
```
┌─────────────────────────────────────┐
│  💬 與 AI 對話              [−] [×] │
├─────────────────────────────────────┤
│                                     │
│  🤖: 我正在分析儀表板資料...         │
│     發現品質評分從昨天 96.1% 下降    │
│     到今天 95.2%，主要原因是         │
│     vendor_master 新增資料品質較差   │
│                                     │
│     要我生成詳細報告嗎？             │
│     [是] [否] [查看原始資料]         │
│                                     │
├─────────────────────────────────────┤
│  👤: 為什麼 vendor_master_sync 失敗？│
│                                     │
│  🤖: 分析日誌後發現根本原因：        │
│     • 來源資料庫連線超時 (60%)       │
│     • 記憶體不足 (30%)               │
│                                     │
│     建議解決方案：                   │
│     ✓ 增加超時時間到 60s             │
│     ✓ 調整排程避開高峰               │
│                                     │
│     要我自動優化設定嗎？             │
│     [是，立即優化] [手動調整]        │
│                                     │
├─────────────────────────────────────┤
│  💡 快速操作                         │
│  • 查詢今天的作業狀態                │
│  • 生成品質週報                      │
│  • 重試失敗的作業                    │
│  • 查看異常資料                      │
├─────────────────────────────────────┤
│  ┌───────────────────────────────┐  │
│  │ 輸入訊息... (Enter 發送)      │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

**收起狀態**:
```
         ┌──────────┐
         │ 💬 AI 助手│  ← 懸浮在右下角
         └──────────┘
           ⚫ 1 則新訊息
```

**特色功能**:
1. **上下文感知**: AI 知道使用者在看哪個頁面
2. **主動建議**: 發現問題主動提示
3. **一鍵操作**: 使用者確認後 AI 直接執行
4. **歷史記錄**: 可查看對話歷史
5. **快捷鍵**: `Ctrl+K` 快速呼叫

---

### 模組 2: ETL 作業管理（強化可視化）

#### 2.1 作業列表視圖
```
┌─────────────────────────────────────────────────────┐
│  ⚙️ ETL 作業管理                      [+ 新增作業]    │
├─────────────────────────────────────────────────────┤
│  🔍 [搜尋]  [全部▾] [狀態▾] [標籤▾]    📊 [視圖: 列表]│
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 🟢 material_master_sync              已啟用     │ │
│  │ ERP 物料主檔同步                                │ │
│  │                                                │ │
│  │ ⏱️ 排程: 每日 02:00  |  ⚡ 平均 2.5 分鐘         │ │
│  │                                                │ │
│  │ 最後執行: 2 小時前 ✅ 成功 | 1,348 rows         │ │
│  │                                                │ │
│  │ 📊 成功率 (30天): ████████████████████ 100%    │ │
│  │                                                │ │
│  │ [▶ 執行] [✏️ 編輯] [📋 查看記錄] [⋮ 更多]      │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 🔴 vendor_master_sync                已啟用     │ │
│  │ ERP 廠商主檔同步                                │ │
│  │                                                │ │
│  │ ⏱️ 排程: 每日 02:30  |  ⚡ 平均 5.2 分鐘 ⚠️ 緩慢 │ │
│  │                                                │ │
│  │ 最後執行: 30 分鐘前 ❌ 失敗 | Connection timeout│ │
│  │                                                │ │
│  │ 📊 成功率 (30天): █████████████▒▒▒▒▒▒▒ 68%    │ │
│  │                                                │ │
│  │ 💡 AI 建議: 這個作業需要優化 [查看建議]         │ │
│  │                                                │ │
│  │ [🔄 重試] [✏️ 編輯] [📋 查看記錄] [⋮ 更多]     │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
└─────────────────────────────────────────────────────┘
```

#### 2.2 作業詳情頁（深度分析）
```
┌─────────────────────────────────────────────────────┐
│  ← 返回  vendor_master_sync                [編輯]    │
├─────────────────────────────────────────────────────┤
│                                                      │
│  📊 作業概覽                                          │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────┐│
│  │ 成功率    │ │ 平均時長  │ │ 最後執行  │ │ 下次   ││
│  │  68%     │ │  5.2 分   │ │ 30 分前  │ │ 明天   ││
│  │  🔴 低   │ │  ⚠️ 緩慢  │ │  ❌ 失敗  │ │ 02:30  ││
│  └──────────┘ └──────────┘ └──────────┘ └────────┘│
│                                                      │
├─────────────────────────────────────────────────────┤
│  📈 執行趨勢 (30 天)                                  │
│                                                      │
│  時長趨勢:                                            │
│  10m ┤                                ╱─            │
│   5m ┤        ──────────────────────╱               │
│   0m └──────────────────────────────────            │
│       30天前          15天前           今天          │
│                                                      │
│  成功率:                                              │
│  100%┤ ████████████████                             │
│   50%┤              ▓▓▓▓▓▓▓▓▓▓▓▓▓▓ ← 最近惡化        │
│    0%└──────────────────────────────────            │
│                                                      │
├─────────────────────────────────────────────────────┤
│  🤖 AI 分析報告                                       │
│                                                      │
│  ⚠️ 發現 3 個問題:                                    │
│                                                      │
│  1. 執行時間持續增加 (2.5m → 5.2m, +108%)           │
│     根因: 來源資料量增長 + 缺少索引                   │
│     影響: 可能導致後續作業延遲                        │
│                                                      │
│  2. 成功率下降 (100% → 68%, -32%)                    │
│     根因: 連線超時 (60%)、記憶體不足 (30%)           │
│     影響: 資料同步不完整，影響報表準確性              │
│                                                      │
│  3. 資源使用率高 (CPU 85%, Memory 92%)               │
│     根因: 批次大小過大                                │
│     影響: 影響其他作業執行                            │
│                                                      │
│  💡 建議操作:                                         │
│  ┌────────────────────────────────────────────────┐ │
│  │ ✅ 高優先級 (預期提升 65%)                        │ │
│  │   • 在來源表建立索引 (pmc01, pmc02)              │ │
│  │   • 增加連線超時時間 (30s → 60s)                 │ │
│  │   • 調整批次大小 (1000 → 500)                    │ │
│  │                                                  │ │
│  │ ⚡ 中優先級 (預期提升 15%)                        │ │
│  │   • 調整排程時間 (02:30 → 03:30 避開高峰)        │ │
│  │   • 啟用資料壓縮傳輸                              │ │
│  │                                                  │ │
│  │ [🚀 一鍵優化] [✏️ 手動調整] [❌ 忽略]            │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
├─────────────────────────────────────────────────────┤
│  📋 執行歷史 (最近 10 次)                             │
│  ┌──────┬─────────┬────────┬──────┬──────────────┐ │
│  │ 狀態  │ 開始時間 │ 時長    │ 行數  │ 錯誤         │ │
│  ├──────┼─────────┼────────┼──────┼──────────────┤ │
│  │ ❌   │ 02:30   │ -      │ 0    │ Timeout      │ │
│  │ ✅   │ 昨天    │ 5.1m   │ 9,972│ -            │ │
│  │ ❌   │ 前天    │ -      │ 0    │ Out of mem   │ │
│  │ ✅   │ 3天前   │ 4.8m   │ 9,968│ -            │ │
│  └──────┴─────────┴────────┴──────┴──────────────┘ │
│  [查看全部] [匯出報表]                                │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**一鍵優化功能**:
點擊 [🚀 一鍵優化] 後：
```
┌─────────────────────────────────────┐
│  🚀 正在優化 vendor_master_sync      │
├─────────────────────────────────────┤
│  ✅ 已增加連線超時時間                │
│  ✅ 已調整批次大小                    │
│  ✅ 已調整排程時間                    │
│  🔄 正在建立索引建議... 50%           │
│                                     │
│  預計完成時間: 30 秒                 │
└─────────────────────────────────────┘
```

---

### 模組 3: 資料品質管理（視覺化重點）

#### 3.1 品質總覽儀表板
```
┌─────────────────────────────────────────────────────┐
│  ✅ 資料品質管理                                      │
├─────────────────────────────────────────────────────┤
│                                                      │
│  📊 品質總覽                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌─────────────┐ │
│  │ 整體評分      │ │ 未解決問題    │ │ 檢查次數    │ │
│  │              │ │              │ │             │ │
│  │   95.2%     │ │     12       │ │    150      │ │
│  │  🟢 優秀     │ │  🔴3 🟡9     │ │  (本週)     │ │
│  │              │ │              │ │             │ │
│  │  ▲ +1.3%    │ │  ▼ +2        │ │  ▲ +10      │ │
│  │  vs 昨天     │ │  vs 昨天     │ │  vs 上週    │ │
│  └──────────────┘ └──────────────┘ └─────────────┘ │
│                                                      │
├─────────────────────────────────────────────────────┤
│  📈 品質趨勢 (7 天)                                   │
│                                                      │
│  100% ┤                                             │
│       │                                             │
│   95% ┤  vendor_master    ──────◄ 92.5%            │
│       │       ╱──╲                                  │
│   90% ┤──────╱    ╲─ material_master ◄ 98.1%       │
│       │             ╲                               │
│   85% ┤              ╲─ tax_code_master ◄ 87.3%    │
│       │                                             │
│       └─────────────────────────────────            │
│         7天前    5天前    3天前    今天              │
│                                                      │
│  💡 vendor_master 趨勢下降，需要關注                 │
│                                                      │
├─────────────────────────────────────────────────────┤
│  📊 資料表品質分布                                    │
│                                                      │
│  [環形圖]                                            │
│       98-100% (Perfect)    ████ 3 張表              │
│       95-97%  (Excellent)  ███  2 張表              │
│       80-94%  (Good)       ██   1 張表              │
│       <80%    (Poor)       █    1 張表              │
│                                                      │
└─────────────────────────────────────────────────────┘
```

#### 3.2 資料表品質詳情（深度分析）
```
┌─────────────────────────────────────────────────────┐
│  ← 返回  vendor_master 品質分析                       │
├─────────────────────────────────────────────────────┤
│                                                      │
│  📊 整體評分: 92.5% 🟢 EXCELLENT                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━          │
│  █████████████████████████████████▒▒▒▒▒▒           │
│                                                      │
│  趨勢: ▼ -2.1% (vs 昨天 94.6%)                      │
│                                                      │
├─────────────────────────────────────────────────────┤
│  🎯 品質維度分析                                      │
│                                                      │
│  [雷達圖]                                            │
│         完整性                                        │
│           ╱ ╲                                       │
│    準確性 /   \ 一致性                               │
│         │  ⚫  │                                     │
│    即時性 \   / 合規性                               │
│           ╲ ╱                                       │
│         有效性                                        │
│                                                      │
│  完整性: 87.5% 🟡 (主要問題)                         │
│  準確性: 98.2% 🟢                                    │
│  一致性: 96.8% 🟢                                    │
│  即時性: 92.1% 🟢                                    │
│  有效性: 94.5% 🟢                                    │
│  合規性: 100%  🟢                                    │
│                                                      │
├─────────────────────────────────────────────────────┤
│  ⚠️ 品質問題列表 (按嚴重性)                           │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 🔴 CRITICAL | tax_number                       │ │
│  │                                                │ │
│  │ 問題: 空值比例過高 15.2%                        │ │
│  │ 影響: 1,517 / 9,972 rows                       │ │
│  │ 趨勢: [小型折線圖] 持續惡化                     │ │
│  │                                                │ │
│  │ 💡 AI 根因分析:                                 │ │
│  │ 1. 來源系統未強制填寫                           │ │
│  │ 2. 新增廠商流程缺少驗證                         │ │
│  │ 3. 歷史資料未補齊                               │ │
│  │                                                │ │
│  │ 💡 AI 建議修復:                                 │ │
│  │ • 建立清理規則自動補齊（成功率 85%）            │ │
│  │ • 通知業務人員補填（剩餘 15%）                  │ │
│  │ • 來源系統增加驗證（預防未來）                  │ │
│  │                                                │ │
│  │ [🔧 一鍵修復] [📋 查看資料] [👤 指派處理]       │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 🟡 WARNING | bank_account                      │ │
│  │                                                │ │
│  │ 問題: 格式不統一                                │ │
│  │ 影響: 78 / 9,972 rows (0.8%)                   │ │
│  │                                                │ │
│  │ 格式分布: [圓餅圖]                              │ │
│  │ • 16碼數字    92% ✅                            │ │
│  │ • 含橫線      5%  (例: 1234-5678-9012-3456)    │ │
│  │ • 含空格      2%  (例: 1234 5678 9012 3456)    │ │
│  │ • 其他        1%                                │ │
│  │                                                │ │
│  │ 💡 AI 建議: 統一格式為 16碼數字                 │ │
│  │                                                │ │
│  │ [🔧 一鍵修復] [📋 查看資料]                     │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**一鍵修復功能**:
```
點擊 [🔧 一鍵修復] 後:

┌─────────────────────────────────────┐
│  🔧 修復方案預覽                     │
├─────────────────────────────────────┤
│  AI 已分析 1,517 筆空值資料          │
│                                     │
│  修復策略:                           │
│  ✓ 1,289 筆 (85%) 可自動推斷        │
│    (根據公司名稱、地址等)            │
│                                     │
│  ⚠️ 228 筆 (15%) 需人工確認          │
│    (資訊不足，無法推斷)              │
│                                     │
│  預期品質提升: 87.5% → 98.2%        │
│                                     │
│  [預覽修復結果] [確認修復] [取消]    │
└─────────────────────────────────────┘
```

---

### 模組 4: 元數據管理（血緣可視化）

#### 4.1 資料血緣圖（D3.js）
```
┌─────────────────────────────────────────────────────┐
│  🔗 資料血緣追蹤                      [全螢幕] [匯出]  │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Source Layer        Clean Layer       Mart Layer   │
│                                                      │
│  ┌──────────┐       ┌───────────┐    ┌──────────┐ │
│  │ ERP      │──────▶│ material_ │───▶│ monthly_ │ │
│  │ m2201_   │       │ master    │    │ sales    │ │
│  │ ima_file │       └───────────┘    └──────────┘ │
│  └──────────┘             │                        │
│                            │                        │
│  ┌──────────┐             │          ┌──────────┐ │
│  │ ERP      │──────▶┌────▼──────┐───▶│ vendor_  │ │
│  │ m2201_   │       │ vendor_   │    │ analysis │ │
│  │ pmc_file │       │ master    │    └──────────┘ │
│  └──────────┘       └───────────┘                  │
│                                                      │
│  [互動功能]                                          │
│  • 點擊節點查看詳情                                  │
│  • 拖曳調整位置                                      │
│  • 滑鼠懸停顯示轉換邏輯                              │
│  • 篩選特定資料表的血緣                              │
│                                                      │
└─────────────────────────────────────────────────────┘

[點擊 vendor_master 節點後]

┌─────────────────────────────────────┐
│  📊 vendor_master 詳情               │
├─────────────────────────────────────┤
│  來源: erp_m2201_pmc_file           │
│  目標: 2 個下游表                    │
│  • vendor_analysis                  │
│  • purchase_summary                 │
│                                     │
│  欄位對應:                           │
│  pmc01 → vendor_id (直接對應)       │
│  pmc02 → vendor_name (清理空白)     │
│  pmc03 → tax_number (格式標準化)    │
│  ...                                │
│                                     │
│  最後更新: 2 小時前                  │
│  更新頻率: 每日                      │
│                                     │
│  [查看轉換邏輯] [查看資料品質]       │
└─────────────────────────────────────┘
```

#### 4.2 欄位級血緣（表格 + 視覺化）
```
┌─────────────────────────────────────────────────────┐
│  🔗 欄位血緣: vendor_master.tax_number               │
├─────────────────────────────────────────────────────┤
│                                                      │
│  [桑基圖 Sankey Diagram]                             │
│                                                      │
│  erp_m2201_pmc_file.pmc03 ─────────────────┐        │
│   (來源欄位)                                │        │
│   • 資料類型: VARCHAR(10)                   │        │
│   • 範例: "12345678"                        │        │
│                                             │        │
│        │ Level 1: 格式清理                  │        │
│        ├─ 移除空白                          │        │
│        ├─ 轉大寫                            │        │
│        ▼                                    │        │
│                                             │        │
│  clean.vendor_master.tax_number ◄──────────┘        │
│   (中間層)                                           │
│   • 資料類型: VARCHAR(8)                             │
│   • 清理規則: 4 條                                   │
│   • 品質分數: 92.5%                                  │
│                                                      │
│        │                                             │
│        ├─────────────┬────────────┐                 │
│        ▼             ▼            ▼                 │
│                                                      │
│  mart.vendor_report  mart.tax_analysis  ...         │
│   (下游使用)                                         │
│   • 3 個報表使用此欄位                               │
│   • 影響範圍: 高                                     │
│                                                      │
├─────────────────────────────────────────────────────┤
│  🔄 轉換邏輯詳情                                      │
│                                                      │
│  Level 1 - 格式清理:                                 │
│  TRIM(UPPER(pmc03))                                 │
│                                                      │
│  Level 2 - 格式標準化:                               │
│  REGEXP_REPLACE(..., '^\d{8}$')                    │
│                                                      │
│  Level 3 - 資料推斷:                                 │
│  CASE WHEN tax_number IS NULL THEN                  │
│    infer_from_company_name()                        │
│  END                                                │
│                                                      │
│  Level 4 - 自訂規則:                                 │
│  validate_tax_number_checksum()                     │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

### 模組 5: 自然語言查詢（核心 AI 功能）

#### 5.1 查詢介面
```
┌─────────────────────────────────────────────────────┐
│  🔍 智能查詢                                          │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌───────────────────────────────────────────────┐  │
│  │ 用自然語言問任何問題...                        │  │
│  │                                               │  │
│  │ 例如:                                         │  │
│  │ • 今天有哪些作業失敗了？                       │  │
│  │ • vendor_master 的品質評分是多少？            │  │
│  │ • 給我看最近 7 天的 ETL 執行趨勢               │  │
│  │ • 哪個資料表問題最多？                         │  │
│  └───────────────────────────────────────────────┘  │
│                                                      │
├─────────────────────────────────────────────────────┤
│  💬 對話歷史                                          │
│                                                      │
│  👤: 今天有哪些作業失敗了？                           │
│                                                      │
│  🤖: 今天有 2 個作業失敗：                            │
│                                                      │
│     ┌────────────────────────────────────────────┐  │
│     │ ❌ vendor_master_sync                      │  │
│     │ 失敗原因: Connection timeout                │  │
│     │ 失敗時間: 02:30                             │  │
│     │ [查看詳情] [重試]                           │  │
│     └────────────────────────────────────────────┘  │
│                                                      │
│     ┌────────────────────────────────────────────┐  │
│     │ ❌ material_cost_update                    │  │
│     │ 失敗原因: Duplicate key error               │  │
│     │ 失敗時間: 03:15                             │  │
│     │ [查看詳情] [重試]                           │  │
│     └────────────────────────────────────────────┘  │
│                                                      │
│     要我重試這些作業嗎？                             │
│     [是，全部重試] [只重試第一個] [否]               │
│                                                      │
├─────────────────────────────────────────────────────┤
│  👤: 重試第一個                                       │
│                                                      │
│  🤖: ✅ 已重新執行 vendor_master_sync                │
│                                                      │
│     [執行進度 40%] ━━━━━━━━━▒▒▒▒▒▒▒▒▒▒              │
│                                                      │
│     預計完成時間: 3 分鐘後                           │
│     我會持續監控，完成後通知你                       │
│                                                      │
└─────────────────────────────────────────────────────┘
```

#### 5.2 複雜查詢範例
```
👤: 給我看 vendor_master 最近 30 天的品質趨勢，
   並分析為什麼品質下降了

🤖: [自動生成視覺化報表]

┌────────────────────────────────────────────────────┐
│ 📊 vendor_master 品質趨勢分析 (30天)                │
├────────────────────────────────────────────────────┤
│                                                     │
│  品質評分變化:                                       │
│  100% ┤                                            │
│   95% ┤ ──────────╲                                │
│   90% ┤            ╲────────◄ 當前 92.5%          │
│   85% ┤                                            │
│       └─────────────────────────                   │
│        30天前    15天前     今天                    │
│                                                     │
│  主要變化:                                          │
│  • 2026-02-01: 品質從 96% 下降到 93% (-3%)         │
│  • 2026-02-08: 持續下降到 92.5% (-0.5%)            │
│                                                     │
│  🔍 根因分析:                                        │
│                                                     │
│  1. tax_number 空值率上升 (12% → 15%)              │
│     • 原因: 新增 342 筆廠商資料未填寫稅號           │
│     • 時間點: 2026-02-01                           │
│     • 建議: 加強新增資料驗證                        │
│                                                     │
│  2. bank_account 格式不統一增加 (45 → 78 rows)     │
│     • 原因: 不同業務人員輸入格式不同                │
│     • 時間點: 2026-02-05 ~ 2026-02-10              │
│     • 建議: 統一輸入介面格式                        │
│                                                     │
│  3. 資料更新頻率降低                                │
│     • 原因: ETL 作業失敗次數增加                    │
│     • 影響: 資料即時性下降                          │
│     • 建議: 優化 vendor_master_sync 作業            │
│                                                     │
│  💡 快速修復建議:                                    │
│  [🔧 自動修復 tax_number (預期提升 2%)]             │
│  [🔧 統一 bank_account 格式 (預期提升 0.5%)]       │
│  [⚙️ 優化 ETL 作業 (預期提升 0.8%)]                │
│                                                     │
│  預期修復後品質: 95.8% 🟢 EXCELLENT                 │
│                                                     │
└────────────────────────────────────────────────────┘
```

---

## 🚀 開發計畫（最終版）

### 總時程: 10 週

#### Phase 1: 基礎架構 (Week 1-2)
**目標**: 建立專案骨架與核心功能

**前端**:
- [x] Vue.js 3 專案建置
- [x] Ant Design Vue 整合
- [x] 路由與佈局設計
- [x] 主題與樣式系統

**後端**:
- [x] Node.js + Express 專案建置
- [x] PostgreSQL 資料庫設計
- [x] Prisma ORM 整合
- [x] JWT 認證系統

**AI 基礎**:
- [x] Claude API 整合
- [x] AI Gateway 服務架構

**交付物**: 
- 可登入的系統骨架
- 基礎頁面佈局
- AI 對話基礎功能

---

#### Phase 2: ETL 作業管理 (Week 3-4)
**目標**: ETL 作業的完整管理與監控

**功能**:
- [x] 作業 CRUD
- [x] 作業執行引擎 (Bull Queue)
- [x] 執行歷史記錄
- [x] 排程管理 (node-cron)

**可視化**:
- [x] 作業列表視圖（成功率、趨勢）
- [x] 作業詳情頁（深度分析）
- [x] 執行趨勢圖表（ECharts）

**AI 整合**:
- [x] AI 分析作業效能
- [x] AI 提供優化建議
- [x] 一鍵優化功能

**交付物**:
- ETL 作業可配置與執行
- 視覺化監控介面
- AI 效能分析

---

#### Phase 3: 資料品質管理 (Week 5-6)
**目標**: 完整的品質監控與問題追蹤

**功能**:
- [x] 品質規則管理
- [x] 品質檢查執行
- [x] 問題追蹤系統
- [x] 整合現有品質檢查系統

**可視化**:
- [x] 品質總覽儀表板
- [x] 資料表品質詳情
- [x] 品質趨勢圖（時間序列）
- [x] 品質維度雷達圖

**AI 整合**:
- [x] 異常檢測 (Isolation Forest)
- [x] 品質預測（時間序列）
- [x] 自動規則推薦
- [x] 一鍵修復功能

**交付物**:
- 品質監控系統
- 問題追蹤與修復
- AI 異常檢測

---

#### Phase 4: 元數據管理 (Week 7)
**目標**: 元數據管理與血緣追蹤

**功能**:
- [x] 元數據掃描與同步
- [x] 資料表/欄位管理
- [x] 血緣關係追蹤
- [x] 整合現有元數據系統

**可視化**:
- [x] 資料血緣圖（D3.js DAG）
- [x] 欄位級血緣（桑基圖）
- [x] 元數據瀏覽器

**AI 整合**:
- [x] 自動生成欄位描述
- [x] 智能血緣推斷
- [x] 自動標籤分類

**交付物**:
- 元數據管理系統
- 血緣可視化
- AI 元數據生成

---

#### Phase 5: 自然語言介面 (Week 8)
**目標**: 完整的 AI 對話與操作能力

**功能**:
- [x] 意圖識別
- [x] 自然語言查詢
- [x] 對話式操作（執行任務）
- [x] 上下文管理

**UI**:
- [x] AI 助手面板（右下角常駐）
- [x] 智能查詢介面
- [x] 快捷鍵 (Ctrl+K)

**AI 能力**:
- [x] 理解複雜查詢
- [x] 生成視覺化報表
- [x] 執行系統操作
- [x] 主動建議

**交付物**:
- 自然語言介面
- 對話式操作
- AI 主動建議

---

#### Phase 6: 資料清理 & 告警 (Week 9)
**目標**: 資料清理管理與智能告警

**功能**:
- [x] 清理規則管理
- [x] 清理日誌查詢
- [x] 告警規則配置
- [x] 告警記錄與處理

**AI 整合**:
- [x] 自動學習清理模式
- [x] 告警智能過濾
- [x] 根因分析

**交付物**:
- 清理規則系統
- 智能告警系統
- 根因分析引擎

---

#### Phase 7: 測試 & 優化 (Week 10)
**目標**: 測試、優化、部署

**任務**:
- [x] 單元測試
- [x] 整合測試
- [x] 效能測試與優化
- [x] Docker 容器化
- [x] 部署文件
- [x] 使用者手冊

**交付物**:
- 生產就緒系統
- 完整文件
- 部署方案

---

## 💰 成本估算

### 開發成本
- **時間**: 10 週
- **人力**: 1 全端開發者

### 運行成本（月）
| 項目 | 費用 |
|------|------|
| AWS RDS PostgreSQL | 已有 |
| Redis (ElastiCache) | $20 |
| Claude API | $36 |
| Python ML 運算 (EC2 t3.small) | $15 |
| **總計** | **$71/月** |

### ROI
- 節省運維時間: 20 小時/月 = $1,000/月
- **投資回報率**: 14 倍

---

## 📊 成功指標

### 功能性指標
- ✅ 支援管理 100+ ETL 作業
- ✅ 元數據覆蓋率 100%
- ✅ AI 查詢準確率 ≥ 95%
- ✅ 一鍵操作成功率 ≥ 90%

### 效能指標
- ⚡ 頁面載入時間 < 2 秒
- ⚡ AI 回應時間 < 3 秒
- ⚡ API 回應時間 < 500ms

### 使用者體驗
- 😊 操作複雜度降低 85%
- 😊 學習曲線縮短 70%
- 😊 日常運維時間減少 85%

---

## 🎨 UI/UX 設計規範

### 設計原則
1. **清晰 > 花俏**: 資訊清楚比視覺華麗重要
2. **快速 > 完整**: 常用功能快速存取
3. **引導 > 自由**: 引導使用者正確操作
4. **預防 > 修復**: 預防錯誤比事後修復好

### 色彩系統
- 🟢 **成功/正常**: #52c41a
- 🟡 **警告**: #faad14
- 🔴 **錯誤/嚴重**: #f5222d
- 🔵 **執行中**: #1890ff
- ⚪ **停用**: #d9d9d9

### 互動模式
- **懸停提示**: 所有圖示和簡寫都有提示
- **載入狀態**: 所有非同步操作都有載入指示
- **錯誤處理**: 清楚的錯誤訊息和建議操作
- **確認對話**: 重要操作需要確認

---

## 📝 下一步行動

### 立即行動
1. **審核規格書** - 確認所有功能需求
2. **準備環境** - AWS RDS, Redis, 開發機器
3. **技術選型確認** - 確認技術棧無異議

### 開發前準備
1. 建立 Git 倉庫
2. 設定 CI/CD 流程
3. 準備設計資源（UI mockup）
4. 建立專案管理看板

### 啟動開發
- **預計開始**: 確認後 3 天內
- **首個里程碑**: 2 週後（Phase 1 完成）
- **MVP 上線**: 6 週後（Phase 1-3 完成）
- **完整版上線**: 10 週後

---

**準備好開始了嗎？** 🚀

我已經準備好開始開發，只等您的確認！

需要我：
1. 調整任何功能？
2. 修改時程？
3. 準備其他文件？
4. 立即開始建立專案骨架？

請告訴我！😊

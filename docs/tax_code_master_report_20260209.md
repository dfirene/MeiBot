# ERP ç¨…åˆ¥ç¢¼ä¸»æª”æ•´åˆå ±å‘Š
**æ—¥æœŸ:** 2026-02-09  
**æ‰¹æ¬¡ç·¨è™Ÿ:** BATCH-20260209-002

---

## ğŸ“Š è¡¨æ ¼è³‡è¨Š

| é …ç›® | å…§å®¹ |
|-----|------|
| **Clean è¡¨æ ¼åç¨±** | `tax_code_master` |
| **ä¸­æ–‡åç¨±** | ç¨…åˆ¥ç¢¼ä¸»æª” |
| **ä¾†æºè¡¨æ ¼** | `public.erp_m2201_gec_file` |
| **è³‡æ–™ç­†æ•¸** | 36 rows |
| **æ¬„ä½æ•¸é‡** | 25 columns |
| **ä¸»éµ** | `tax_code` |

---

## ğŸ”‘ æ ¸å¿ƒæ¬„ä½èªªæ˜

### åŸºæœ¬è³‡è¨Š
| æ¬„ä½åç¨± | ä¸­æ–‡åç¨± | è³‡æ–™å‹æ…‹ | èªªæ˜ | å®Œæ•´åº¦ |
|---------|---------|---------|------|--------|
| `tax_code` | ç¨…åˆ¥ç¢¼ | VARCHAR(20) | ä¸»éµ - å¦‚ 21, 21-2, 21-3 ç­‰ | 100% |
| `tax_type` | ç¨…åˆ¥é¡å‹ | VARCHAR(10) | 1=é€²é …, 2=éŠ·é … | 100% |
| `tax_name` | ç¨…åˆ¥åç¨± | VARCHAR(200) | å¦‚ã€Œé€²é …ä¸‰è¯å¼ã€é›»å­è¨ˆç®—æ©Ÿçµ±ä¸€ç™¼ç¥¨(æœªç¨…)ã€ | 100% |
| `tax_rate` | ç¨…ç‡ | DECIMAL(5,2) | ç¨…ç‡ (%) - 0, 5 | 100% |

### ç™¼ç¥¨è³‡è¨Š
| æ¬„ä½åç¨± | ä¸­æ–‡åç¨± | è³‡æ–™å‹æ…‹ | èªªæ˜ |
|---------|---------|---------|------|
| `invoice_copy_count` | ç™¼ç¥¨è¯æ•¸ | VARCHAR(10) | ç™¼ç¥¨è¯æ•¸ (3, 4 ç­‰) |
| `tax_category` | ç¨…å‹™é¡åˆ¥ | VARCHAR(10) | 1=æ‡‰ç¨…, 2=é›¶ç¨…ç‡, 3=å…ç¨… |
| `price_includes_tax` | å–®åƒ¹å«ç¨…å¦ | BOOLEAN | true=å«ç¨…, false=æœªç¨… |
| `media_report_format` | åª’é«”ç”³å ±æ ¼å¼ | VARCHAR(20) | åª’é«”ç”³å ±æ ¼å¼ä»£ç¢¼ (21, 22 ç­‰) |

### æœƒè¨ˆè³‡è¨Š
| æ¬„ä½åç¨± | ä¸­æ–‡åç¨± | å®Œæ•´åº¦ |
|---------|---------|--------|
| `accounting_account` | æœƒè¨ˆç§‘ç›®ç·¨è™Ÿ | 52.78% |
| `accounting_account_2` | æœƒè¨ˆç§‘ç›®ç·¨è™ŸäºŒ | - |

---

## ğŸ”„ è³‡æ–™è½‰æ›è¦å‰‡

### 1. Boolean è½‰æ›
```sql
-- gec07 (Y/N) â†’ price_includes_tax (BOOLEAN)
price_includes_tax = (gec07 = 'Y')

-- gecacti (Y/N) â†’ is_active (BOOLEAN)
is_active = (gecacti = 'Y')

-- gecpos (Y/N) â†’ pos_transmitted (BOOLEAN)
pos_transmitted = (gecpos = 'Y')
```

### 2. NULL è™•ç†
```sql
-- ç©ºå­—ä¸²è½‰ NULL
accounting_account = NULLIF(gec03, '')

-- NULL è½‰ 0
tax_rate = COALESCE(gec04, 0)
```

---

## ğŸ“ˆ è³‡æ–™å“è³ªåˆ†æ

### å®Œæ•´åº¦çµ±è¨ˆ
| æ¬„ä½ | å®Œæ•´åº¦ | èªªæ˜ |
|-----|--------|------|
| ç¨…åˆ¥ç¢¼ | 100% | âœ… å®Œå…¨ç„¡ç¼º |
| é€²/éŠ·é … | 100% | âœ… å®Œå…¨ç„¡ç¼º |
| ç¨…åˆ¥åç¨± | 100% | âœ… å®Œå…¨ç„¡ç¼º |
| æœƒè¨ˆç§‘ç›® | 52.78% | âš ï¸ éƒ¨åˆ†è³‡æ–™ç¼ºæ¼ (19/36) |
| ç¨…ç‡ | 100% | âœ… å®Œå…¨ç„¡ç¼º |
| ç™¼ç¥¨è¯æ•¸ | 100% | âœ… å®Œå…¨ç„¡ç¼º |
| ç¨…å‹™é¡åˆ¥ | 100% | âœ… å®Œå…¨ç„¡ç¼º |
| å–®åƒ¹å«ç¨…å¦ | 100% | âœ… å®Œå…¨ç„¡ç¼º |
| è³‡æ–™æœ‰æ•ˆç¢¼ | 100% | âœ… å®Œå…¨ç„¡ç¼º |

### ç¨…å‹™é¡åˆ¥åˆ†ä½ˆ
```sql
-- æ¨£æœ¬æŸ¥è©¢
SELECT 
    tax_category,
    CASE tax_category
        WHEN '1' THEN 'æ‡‰ç¨…'
        WHEN '2' THEN 'é›¶ç¨…ç‡'
        WHEN '3' THEN 'å…ç¨…'
    END as category_name,
    COUNT(*) as count
FROM clean.tax_code_master
GROUP BY tax_category
ORDER BY tax_category;
```

### ç¨…ç‡åˆ†ä½ˆ
```sql
-- æ¨£æœ¬æŸ¥è©¢
SELECT 
    tax_rate,
    COUNT(*) as count,
    ROUND(100.0 * COUNT(*) / SUM(COUNT(*)) OVER(), 2) as percentage
FROM clean.tax_code_master
GROUP BY tax_rate
ORDER BY tax_rate;
```

---

## ğŸ“‹ æ¨£æœ¬è³‡æ–™

### é€²é …ç¨…åˆ¥ç¢¼ç¯„ä¾‹
| ç¨…åˆ¥ç¢¼ | ç¨…åˆ¥åç¨± | ç¨…ç‡ | ç¨…å‹™é¡åˆ¥ | å«ç¨… |
|-------|---------|------|----------|------|
| 21 | é€²é …ä¸‰è¯å¼ã€é›»å­è¨ˆç®—æ©Ÿçµ±ä¸€ç™¼ç¥¨(æœªç¨…) | 5.00% | æ‡‰ç¨… | âŒ |
| 21-2 | é€²é …ä¸‰è¯å¼ã€é›»å­è¨ˆç®—æ©Ÿçµ±ä¸€ç™¼ç¥¨(é›¶ç¨…) | 0.00% | é›¶ç¨…ç‡ | âŒ |
| 21-3 | é€²é …ä¸‰æ©Ÿå¼ã€é›»å­è¨ˆç®—æ©Ÿçµ±ä¸€ç™¼ç¥¨(å…ç¨…) | 0.00% | å…ç¨… | âŒ |
| 21-4 | é€²é …ä¸‰æ©Ÿå¼ã€é›»å­è¨ˆç®—æ©Ÿçµ±ä¸€ç™¼ç¥¨(å«ç¨…) | 5.00% | æ‡‰ç¨… | âœ… |
| 22 | é€²é …äºŒè¯å¼æ”¶éŠ€æ©Ÿçµ±ä¸€ç™¼ç¥¨(å«ç¨…) | 5.00% | æ‡‰ç¨… | âœ… |
| 11 | é€²é …å…ç”¨çµ±ä¸€ç™¼ç¥¨ | 0.00% | å…ç¨… | âŒ |
| 12 | æ”¶æ“š(æ‰£ç¹³ã€å…¬æœƒåˆæ³•æ†‘è­‰â€¦ç­‰) | 0.00% | å…ç¨… | âŒ |

---

## ğŸ—‚ï¸ Metadata è¨»å†Š

### _metadata_table
- âœ… è¡¨æ ¼è¨»å†Š: `tax_code_master`
- ğŸ“Š è³‡æ–™ç­†æ•¸: 36 rows
- ğŸ“ ä¾†æºç³»çµ±: ERP
- ğŸ“ ä¾†æºè¡¨æ ¼: erp_m2201_gec_file

### _metadata_column
- âœ… æ¬„ä½è¨»å†Š: **25 å€‹å®Œæ•´æ¬„ä½**
- åŒ…å«ä¸»éµã€åŸºæœ¬è³‡è¨Šã€ç™¼ç¥¨è³‡è¨Šã€ç‹€æ…‹ã€å¯©è¨ˆã€ä¾†æºè¿½è¹¤ã€ETL æ¬„ä½

### _metadata_column_mapping
- âœ… å°æ‡‰é—œä¿‚: 9 ç­†
- åŒ…å« DIRECT, BOOLEAN, NULLIF, COALESCE è½‰æ›è¦å‰‡

### _cleansing_log
- âœ… æ¸…æ´—è¨˜éŒ„: 4 ç­†
- å±¤ç´š: Level 1 (FORMAT)
- è½‰æ›: accounting_account, tax_rate, price_includes_tax, is_active

### _metadata_statistics
- âœ… çµ±è¨ˆè¨˜éŒ„: 1 ç­†
- æˆåŠŸç‡: 100%
- æ¸…æ´—æ¬„ä½æ•¸: 4
- ETL è€—æ™‚: 1 ç§’

---

## ğŸ¯ æ‡‰ç”¨å ´æ™¯

### 1. ç™¼ç¥¨é–‹ç«‹
```sql
-- æŸ¥è©¢æ‡‰ç¨…ä¸”å«ç¨…çš„ç¨…åˆ¥ç¢¼
SELECT tax_code, tax_name, tax_rate
FROM clean.tax_code_master
WHERE tax_category = '1' 
  AND price_includes_tax = true
  AND is_active = true;
```

### 2. é›¶ç¨…ç‡å•†å“
```sql
-- æŸ¥è©¢é›¶ç¨…ç‡çš„ç¨…åˆ¥ç¢¼
SELECT tax_code, tax_name, tax_type
FROM clean.tax_code_master
WHERE tax_category = '2'
  AND is_active = true;
```

### 3. ç¨…å‹™ç”³å ±
```sql
-- æŒ‰åª’é«”ç”³å ±æ ¼å¼åˆ†çµ„
SELECT 
    media_report_format,
    COUNT(*) as tax_code_count,
    AVG(tax_rate) as avg_tax_rate
FROM clean.tax_code_master
WHERE is_active = true
GROUP BY media_report_format
ORDER BY media_report_format;
```

---

## ğŸ” èˆ‡å…¶ä»–ä¸»æª”çš„é—œè¯

### å¯èƒ½çš„å¤–éµé—œä¿‚
```sql
-- æœªä¾†å¯å»ºç«‹çš„é—œè¯
-- sales_order_detail.tax_code â†’ tax_code_master.tax_code
-- purchase_order_detail.tax_code â†’ tax_code_master.tax_code
-- invoice_header.tax_code â†’ tax_code_master.tax_code
```

---

## ğŸ“Š æ•´åˆé€²åº¦ç¸½è¦½

| è¡¨æ ¼åç¨± | ä¸­æ–‡åç¨± | è³‡æ–™ç­†æ•¸ | ç‹€æ…‹ |
|---------|---------|---------|------|
| material_master | æ–™ä»¶ä¸»æª” | 1,348 | âœ… å®Œæˆ |
| unit_master | å–®ä½ä¸»æª” | 5 | âœ… å®Œæˆ |
| vendor_master | ä¾›æ‡‰å•†ä¸»æª” | 9,972 | âœ… å®Œæˆ |
| material_cost | æ–™ä»¶æˆæœ¬ä¸»æª” | 1,050 | âœ… å®Œæˆ |
| **tax_code_master** | **ç¨…åˆ¥ç¢¼ä¸»æª”** | **36** | **âœ… å®Œæˆ** |

**ç´¯è¨ˆæ•´åˆè³‡æ–™:** 12,411 ç­†

---

## âœ… å®Œæˆæª¢æŸ¥æ¸…å–®

- [x] å»ºç«‹ `clean.tax_code_master` è¡¨æ ¼
- [x] å°å…¥ 36 ç­†è³‡æ–™
- [x] è¨»å†Š 25 å€‹å®Œæ•´æ¬„ä½ metadata
- [x] è¨˜éŒ„ 9 ç­† column mapping
- [x] è¨˜éŒ„ 4 ç­† cleansing log
- [x] æ›´æ–°çµ±è¨ˆè³‡æ–™
- [x] å»ºç«‹ç´¢å¼• (tax_type, tax_category, is_active)
- [x] ç”¢ç”Ÿæ•´åˆå ±å‘Š

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥å»ºè­°

1. â³ ç¹¼çºŒæ•´ç†å…¶ä»– ERP ä¸»æª” (å®¢æˆ¶ã€å€‰åº«ã€éƒ¨é–€ç­‰)
2. â³ å»ºç«‹ Mart Layer è¦–åœ–/è¡¨æ ¼
3. â³ é©—è­‰è³‡æ–™æ­£ç¢ºæ€§ï¼ˆæŠ½æ¨£æª¢æŸ¥ï¼‰
4. â³ å»ºç«‹è·¨è¡¨é—œè¯ï¼ˆå¤–éµç´„æŸï¼‰

---

**æ•´åˆå®Œæˆï¼** ğŸ‰

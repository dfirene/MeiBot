# 資料治理管理平台 (DGP) - 完整開發規格書

**版本**: 2.0 Final (整合版)  
**日期**: 2026-02-14  
**專案代號**: Data Governance Platform (DGP)  
**定位**: Web-based AI 賦能資料治理平台

---

## 📋 文件說明

本規格書整合了 2026-02-13 所有討論與優化內容：
1. ✅ 原始系統規劃
2. ✅ AI 賦能功能補充（14 大 AI 能力）
3. ✅ 整合方案確認（Web-only，無 Telegram）
4. ✅ Metadata 整合方案（7 張表完整納入）
5. ✅ Skills 架構設計（節省 50% Token）
6. ✅ 新增 4 個進階 AI 功能

---

## 目錄

- [1. 專案概述](#1-專案概述)
- [2. 核心設計原則](#2-核心設計原則)
- [3. 系統架構](#3-系統架構)
- [4. AI 賦能功能（完整版）](#4-ai-賦能功能完整版)
- [5. 核心功能模組](#5-核心功能模組)
- [6. Metadata 整合方案](#6-metadata-整合方案)
- [7. Skills 架構設計](#7-skills-架構設計)
- [8. 技術架構與選型](#8-技術架構與選型)
- [9. 開發計畫](#9-開發計畫)
- [10. 成本分析](#10-成本分析)
- [11. 成功指標](#11-成功指標)
- [12. 風險評估](#12-風險評估)

---

## 1. 專案概述

### 1.1 系統目標

建立一個 **統一的 Web-based 資料治理管理平台**，提供：
- 多資料源整合管理（PostgreSQL、MySQL、API 等）
- ETL 管道可視化監控與優化
- 資料品質即時監控與智能告警
- 元數據管理與血緣追蹤
- **完整 AI 賦能**（14 大 AI 功能）
- 自然語言操作介面

### 1.2 核心價值主張

**從傳統管理到 AI 驅動**

| 傳統方式 | DGP AI 驅動 |
|---------|------------|
| 被動發現問題 | 主動預警與預測 |
| 手動定義規則 | AI 自動學習與推薦 |
| 告警疲勞 | 智能過濾，精準告警 |
| 複雜操作 | 自然語言對話操作 |
| 需要專家 | AI 輔助，降低門檻 |

**ROI**:
- 節省 85% 日常運維時間
- 降低 50%+ AI API 成本（透過 Skills）
- 提升 8.8% 資料品質
- 投資回報率：18 倍

### 1.3 適用對象

- **資料工程師**: ETL 管道管理與優化
- **資料分析師**: 資料品質監控與探索
- **資料管理員**: 元數據維護與治理
- **業務使用者**: 自然語言查詢資料狀態

---

## 2. 核心設計原則

### 2.1 可視化優先 (Visualization First)

**原則**: 複雜的資料和分析結果必須用直觀的圖表呈現

**實踐**:
- ❌ 不要：顯示一大堆數字表格
- ✅ 要做：互動式圖表、趨勢線、熱力圖
- ✅ 要做：顏色編碼（紅黃綠）表示狀態
- ✅ 要做：一眼就能看出問題在哪裡

**範例對比**:
```
❌ 不好的設計:
Table: vendor_master | Completeness: 87.5% | Issues: 123 | Last_check: 2026-02-13

✅ 好的設計:
┌────────────────────────────┐
│ 📊 vendor_master           │
│    品質評分  87.5%  🟡 GOOD│
│    ━━━━━━━━━━━━━━━━━━━━━ │
│    █████████████████▒▒▒▒▒ │
│                            │
│ ⚠️ 123 個問題待處理          │
│ [趨勢圖 7天] [查看詳情]     │
└────────────────────────────┘
```

---

### 2.2 操作簡化 (Simplicity in Action)

**原則**: 複雜的操作用簡單的介面完成

**實踐**:
- ✅ 一鍵式操作（一鍵優化、一鍵重試）
- ✅ AI 智能預填（自動填好參數，使用者只需確認）
- ✅ 引導式流程（分步驟完成複雜任務）
- ✅ 拖拉式配置（不需要寫程式碼）

**範例**:
```
傳統建立品質規則:
1. 選擇資料表
2. 選擇欄位
3. 選擇規則類型
4. 填寫條件（正則表達式、SQL）
5. 設定嚴重性
6. 設定通知方式
→ 需要 10+ 步驟

AI 輔助方式:
🤖: "發現 tax_number 都是 8 碼數字，要建立格式檢查嗎？"
👤: [是]
→ 只需 1 個點擊 ✨
```

---

### 2.3 AI 無縫整合 (Seamless AI Integration)

**原則**: AI 不是獨立功能，而是融入每個操作

**實踐**:
- ✅ 每個頁面都有 AI 助手
- ✅ AI 理解當前上下文（知道使用者在看什麼）
- ✅ AI 主動提供建議（不需要使用者問）
- ✅ AI 可以直接執行操作（經使用者授權）

**範例**:
```
[使用者打開 vendor_master_sync 作業詳情頁]

🤖 AI 自動分析並提示:
┌────────────────────────────────────┐
│ 💡 AI 發現了一些問題                 │
├────────────────────────────────────┤
│ 這個作業最近 5 次執行都很慢(5.2 分鐘) │
│ 主要瓶頸: SQL 查詢時間過長 (73%)     │
│                                    │
│ 建議優化:                           │
│ ✓ 建立索引 (預期提升 60%)           │
│ ✓ 調整批次大小                      │
│                                    │
│ [一鍵優化] [查看詳情] [忽略]        │
└────────────────────────────────────┘
```

---

### 2.4 漸進增強 (Progressive Enhancement)

**原則**: 系統可以沒有 AI 運作，有 AI 更好

**實踐**:
- 基礎功能不依賴 AI（手動配置、查詢）
- AI 提供增強體驗（自動建議、預測）
- AI 服務中斷時系統仍可用
- 使用者可選擇 AI 介入程度

---

## 3. 系統架構

### 3.1 整體架構圖

```
┌─────────────────────────────────────────────────────────────┐
│                    使用者介面層 (Web UI)                      │
│  ┌────────────────┐  ┌──────────────────────────────────┐  │
│  │ Vue.js 3 前端   │  │  右下角 AI 助手面板               │  │
│  │                │  │  - 對話式查詢                     │  │
│  │ - 儀表板        │  │  - 上下文感知                     │  │
│  │ - ETL 管理      │  │  - 一鍵操作                       │  │
│  │ - 品質監控      │  │  - 主動建議                       │  │
│  │ - 元數據瀏覽    │  │                                  │  │
│  │ - 血緣追蹤      │  │  快捷鍵: Ctrl+K                   │  │
│  └────────────────┘  └──────────────────────────────────┘  │
└───────────────────────────┬─────────────────────────────────┘
                            │ HTTPS / WebSocket
┌───────────────────────────┴─────────────────────────────────┐
│                   應用服務層 (Node.js)                        │
│  ┌──────────────────────────────────────────────────────┐   │
│  │          Express.js REST API                         │   │
│  ├──────────────────────────────────────────────────────┤   │
│  │ 認證/授權  │  作業調度   │  資料驗證  │  告警服務      │   │
│  │ (JWT)     │  (Bull)    │           │               │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              AI Gateway Service                       │   │
│  ├──────────────────────────────────────────────────────┤   │
│  │ 意圖識別  │  Skills 路由  │  上下文管理  │  LLM 呼叫  │   │
│  └──────────────────────────────────────────────────────┘   │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────┴─────────────────────────────────┐
│                    AI 服務層 (Python)                         │
│  ┌────────────────┐  ┌────────────────┐  ┌──────────────┐  │
│  │ Claude API     │  │ ML 模型         │  │ Skills 執行   │  │
│  │ (對話/分析)     │  │ (異常檢測/預測) │  │ (預定義邏輯)  │  │
│  └────────────────┘  └────────────────┘  └──────────────┘  │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────┴─────────────────────────────────┐
│                      資料持久層                               │
│  ┌────────────────┐  ┌────────────────┐  ┌──────────────┐  │
│  │ PostgreSQL     │  │ Redis Cache    │  │ pgvector     │  │
│  │ (AWS RDS)      │  │ (Session/Queue)│  │ (向量搜尋)    │  │
│  │                │  │                │  │              │  │
│  │ - dgp DB       │  │                │  │              │  │
│  │ - source DB    │  │                │  │              │  │
│  │   (clean 7表)  │  │                │  │              │  │
│  └────────────────┘  └────────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
┌───────────────────────────┴─────────────────────────────────┐
│                      資料源連接層                             │
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐           │
│  │ ERP DB │  │ WMS DB │  │ MES DB │  │ REST   │           │
│  │(source)│  │        │  │        │  │ APIs   │           │
│  └────────┘  └────────┘  └────────┘  └────────┘           │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 資料流向

#### 一般查詢流程
```
使用者 → Web UI → REST API → PostgreSQL → 返回結果
```

#### AI 輔助流程（使用 Skills）
```
使用者 → "vendor_master 品質如何？"
       → AI Gateway (意圖識別)
       → Skills Router (匹配到 quality_check)
       → Skills 執行 (直接查 DB)
       → 格式化回應 (簡單範本)
       → 使用者

Token 消耗: ~300 (vs 2,500 不用 Skills)
節省: 88%
```

#### AI 複雜分析流程（無對應 Skills）
```
使用者 → "分析為什麼品質下降"
       → AI Gateway (意圖識別)
       → Skills Router (無匹配)
       → Claude API (完整 LLM)
       → 深度分析 + 建議
       → 使用者

Token 消耗: ~3,000 (必要的複雜分析)
```

---

## 4. AI 賦能功能（完整版）

### 4.1 核心 AI 功能（必須實現）

#### 1. 智能異常檢測 (Anomaly Detection)

**技術**: Isolation Forest / Statistical Analysis

**功能**:
- 自動檢測資料中的異常值
- 識別不符合正常模式的記錄
- 時間序列異常（突然增減、週期破壞）
- 多維度關聯異常

**實際應用**:
```
🤖 AI 偵測到異常:

vendor_master.tax_number 空值率異常:
• 正常範圍: 12-15%
• 當前值: 25% ⚠️
• 異常時間: 2026-02-13 14:00
• 影響: 新增 342 筆廠商資料

根因分析:
• 來源系統未驗證
• 批次匯入流程缺少檢查

建議:
✓ 回滾異常批次
✓ 加強來源驗證
✓ 設定告警閾值
```

**價值**: 提前發現問題，減少 95% 發現時間

---

#### 2. 品質預測 (Quality Prediction)

**技術**: Time Series Forecasting (ARIMA/Prophet)

**功能**:
- 預測未來 7/30 天品質趨勢
- 早期預警品質下降
- 預測影響範圍

**實際應用**:
```
🤖 品質預測報告:

vendor_master 未來 7 天預測:
┌─────────┬─────────┬─────────┐
│ 日期     │ 預測值   │ 風險等級 │
├─────────┼─────────┼─────────┤
│ 明天     │ 91.8%   │ 🟢 低    │
│ 後天     │ 90.2%   │ 🟡 中    │
│ +3天    │ 88.5%   │ 🔴 高    │
│ +7天    │ 85.1%   │ 🔴 高    │
└─────────┴─────────┴─────────┘

預警:
如不處理，7 天後品質將降至 85.1%
建議立即執行清理規則
```

**價值**: 從被動響應到主動預防

---

#### 3. 自動規則推薦 (Rule Recommendation)

**技術**: Pattern Mining / Frequent Pattern Analysis

**功能**:
- 從資料中自動發現隱含規則
- AI 建議品質檢查規則
- 學習並優化現有規則

**實際應用**:
```
🤖 AI 分析 vendor_master 後建議:

發現 5 個可建立的規則:

1. 格式規則 (信心度 98%)
   tax_number: 應為 8 碼數字
   當前符合率: 98.2%
   [建立規則]

2. 枚舉規則 (信心度 100%)
   purchase_currency: 只有 4 種值
   (TWD/USD/JPY/EUR)
   [建立規則]

3. 關聯規則 (信心度 95%)
   bank_account 與 bank_code 
   有 95% 同時填寫
   建議: 新增關聯性檢查
   [建立規則]
```

**價值**: 減少手動定義規則時間 87%

---

#### 4. 根因分析 (Root Cause Analysis)

**技術**: Log Analysis / Causal Inference

**功能**:
- 自動分析錯誤日誌
- 追溯根本原因
- 提供解決方案

**實際應用**:
```
🤖 根因分析結果:

作業失敗: vendor_master_sync
━━━━━━━━━━━━━━━━━━━━━━

🔍 直接原因: SQL 執行超時
🔍 根本原因: 來源表缺少索引 (pmc01)
🔍 首次發生: 3 天前
🔍 發生頻率: 最近 10 次中 8 次失敗

連鎖影響:
• vendor_analysis 報表延遲
• API 回應緩慢
• 影響 12 個下游系統

解決方案:
✅ 立即: 增加超時到 60s (臨時)
✅ 短期: 建立索引 (根本解決)
✅ 長期: 分區策略

預期效果:
執行時間: 45s → 5s (減少 89%)
成功率: 20% → 98%
```

**價值**: 快速定位問題，減少 83% 排查時間

---

#### 5. 智能告警過濾 (Alert Filtering)

**技術**: Clustering / Correlation Analysis

**功能**:
- 去重與合併相關告警
- 識別根本告警
- 優先級智能排序

**實際應用**:
```
傳統方式:
🔴 vendor_master_sync 失敗 (02:30)
🔴 material_cost_update 失敗 (02:35)
🔴 quality_check_daily 失敗 (02:40)
🔴 data_export_job 失敗 (02:45)
→ 4 個告警，使用者不知道從哪裡開始

AI 方式:
🔴 根本原因: 資料庫連線中斷
   時間: 02:28 - 02:50
   
   影響的作業:
   • vendor_master_sync
   • material_cost_update  
   • quality_check_daily
   • data_export_job
   
   建議操作:
   1. 檢查資料庫伺服器
   2. 連線恢復後重試所有作業
   
→ 1 個告警，清楚指出根本原因
```

**價值**: 減少 85% 告警數量，提升精準度

---

#### 6. 自動元數據生成 (Metadata Generation)

**技術**: LLM (Claude) / NLP

**功能**:
- 自動生成欄位中文名稱
- 生成欄位描述與範例
- 自動業務分類

**實際應用**:
```
🤖 AI 自動生成元數據:

原始欄位: pmc22
資料內容: "Y", "N", null

AI 生成:
┌────────────────────────────┐
│ 中文名稱: 是否為 VIP 客戶   │
│ 描述: 標記客戶是否為重要客戶│
│       (Y=是, N=否)          │
│ 業務分類: 客戶管理          │
│ 資料類型: CHAR(1)           │
│ 必填: 否                    │
│ 信心度: 92%                 │
│                            │
│ [確認] [編輯] [重新生成]    │
└────────────────────────────┘

批次生成: 43 個欄位 → 15 分鐘完成
手動維護: 43 個欄位 → 3 小時
節省: 92%
```

**價值**: 大幅降低元數據維護成本

---

#### 7. 血緣智能推斷 (Lineage Inference)

**技術**: SQL Parsing / Pattern Matching

**功能**:
- 自動解析 ETL SQL
- 推斷資料血緣關係
- 自動生成血緣圖

**實際應用**:
```
🤖 AI 分析 SQL 後自動推斷:

source.erp_m2201_ima_file.ima01
  ↓ [TRIM(UPPER(ima01))]
clean.material_master.material_id
  ↓ [JOIN with sales]
mart.monthly_sales.product_code

信心度: 98%

自動建立血緣記錄:
INSERT INTO _metadata_column_mapping (
  source_table, source_column,
  target_table, target_column,
  transformation_logic
) VALUES (...);

[確認血緣] [修正] [忽略]
```

**價值**: 自動化血緣追蹤，降低人工維護成本

---

#### 8. 自然語言查詢 (Natural Language Query)

**技術**: LLM (Claude) + Skills

**功能**:
- 用自然語言查詢資料
- 理解複雜查詢意圖
- 自動生成 SQL

**實際應用**:
```
👤: "今天有哪些作業失敗了？"

🤖: 查詢到 2 個失敗作業：

┌────────────────────────────┐
│ ❌ vendor_master_sync      │
│ 失敗原因: Timeout          │
│ 失敗時間: 02:30            │
│ [重試] [查看日誌]          │
└────────────────────────────┘

┌────────────────────────────┐
│ ❌ material_cost_update    │
│ 失敗原因: Duplicate key    │
│ 失敗時間: 03:15            │
│ [重試] [查看日誌]          │
└────────────────────────────┘

要我重試嗎？
[是，全部重試] [只重試第一個]

---

👤: "重試第一個"

🤖: ✅ 已重新執行 vendor_master_sync
   [執行進度 60%] ━━━━━━━▒▒▒
   
   預計完成: 2 分鐘
   我會持續監控並通知你
```

**價值**: 降低 90% 使用門檻

---

#### 9. ETL 效能優化 (Performance Optimization)

**技術**: Query Analysis / Bottleneck Detection

**功能**:
- 分析 ETL 執行日誌
- 識別效能瓶頸
- 提供具體優化建議

**實際應用**:
```
🤖 效能分析報告:

作業: vendor_master_sync
執行時間: 5.2 分鐘
效能評級: ⚠️ 需要優化

瓶頸分析:
1. SQL 查詢: 3.8 分鐘 (73%) ← 主要瓶頸
2. 資料轉換: 0.8 分鐘 (15%)
3. 寫入目標: 0.6 分鐘 (12%)

優化建議:
✅ 高優先級 (預期提升 60%):
   • 在 pmc_file.pmc01 建立索引
   • 使用 BULK INSERT
   
✅ 中優先級 (預期提升 15%):
   • 增加批次大小 1000→2000
   • 平行處理

預期優化後:
執行時間: 5.2 分鐘 → 1.8 分鐘 (減少 65%)
成功率: 68% → 98%

[一鍵優化] [手動調整]
```

**價值**: 提升 40-65% 執行效能

---

#### 10. 一鍵修復功能 (One-Click Fix)

**技術**: AI Analysis + Auto Remediation

**功能**:
- AI 分析問題
- 生成修復方案
- 一鍵執行修復

**實際應用**:
```
🤖 品質問題分析:

vendor_master.tax_number
問題: 1,517 筆空值 (15.2%)

AI 修復方案:
━━━━━━━━━━━━━━━━━━━━
✓ 1,289 筆 (85%) 可自動推斷
  (根據公司名稱、地址等)
  
⚠️ 228 筆 (15%) 需人工確認
  (資訊不足)

預期效果:
• 空值率: 15.2% → 2.3%
• 品質評分: 87.5% → 98.2%
• 完整性: +10.7%

修復預覽:
vendor_id: V001
原值: NULL
推斷值: "12345678"
依據: 統一編號資料庫匹配
信心度: 95%

[預覽全部] [確認修復] [取消]

---

點擊 [確認修復]:

🤖 修復中...
✅ 已修復 1,289 筆 (85%)
📋 已產生 228 筆待人工確認清單
📧 已通知相關人員

品質評分更新: 87.5% → 98.2% ✨
```

**價值**: 減少 90% 手動修復時間

---

### 4.2 進階 AI 功能（強烈建議）

#### 11. 資料探索與洞察 (Data Discovery & Insights) ⭐

**技術**: Statistical Analysis / Association Rule Mining

**功能**:
- 自動探索資料模式
- 發現業務洞察
- 關聯規則挖掘

**實際應用**:
```
🤖 AI 自動探索發現:

分析了 vendor_master，發現有趣的模式：

📊 地理分布:
• 35% 廠商集中在台北
• 12% 在新竹科學園區
• [互動式地圖可視化]

💰 交易模式:
• 大型廠商 (>10M/年) 只佔 8%
  但貢獻 65% 營收
• 識別出 12 個高風險廠商
  (付款延遲 >30 天)

🔗 關聯發現:
• tax_number 空值的廠商
  payment_delay 機率高 3 倍
  
• VIP 廠商的 credit_limit 
  平均高 5 倍

💡 業務建議:
1. 優先補齊高交易量廠商的稅號
2. 對高風險廠商加強信用管控
3. VIP 廠商可考慮提高信用額度

要深入分析某個發現嗎？
```

**價值**: 主動發現業務價值，不只是回答問題

---

#### 12. 智能資料剖析 (Intelligent Data Profiling) ⭐

**技術**: Automated Statistical Profiling

**功能**:
- 自動分析資料特徵
- 識別異常模式
- 生成剖析報告

**實際應用**:
```
🤖 AI 自動剖析 vendor_master:

📊 資料特徵:
• 9,972 rows, 43 columns
• 主鍵: vendor_id (100% unique)
• 外鍵關聯: 5 個下游表

📈 統計摘要:
數值欄位 (15 個):
• 平均完整率: 92.3%
• 離群值檢測: 3 個欄位有異常
  - credit_limit: 5 個值 >100M
  - payment_term: 2 個值 >365 天

文字欄位 (28 個):
• 平均長度: 25 字元
• 格式不一致: 5 個欄位
  - phone: 3 種格式
  - email: 15 筆格式錯誤

🔍 異常模式:
• vendor_name 中 45 筆含 "測試"
• created_date 有 230 筆在週末
  (可能是測試資料)
• 142 筆 last_modified 早於 created_date
  (邏輯錯誤)

💡 建議操作:
1. 清理測試資料 (45 筆)
2. 審查週末建立記錄 (230 筆)
3. 修正時間邏輯錯誤 (142 筆)
4. 統一 phone 格式

[生成完整報告] [執行清理]
```

**價值**: 快速了解資料全貌

---

#### 13. 智能成本優化 (Cost Optimization) ⭐

**技術**: Resource Usage Analysis / Cost Attribution

**功能**:
- 分析 ETL 作業成本
- 識別成本浪費
- 提供優化建議

**實際應用**:
```
🤖 AI 成本分析報告:

💰 ETL 作業成本 (本月):
┌─────────────────────┬──────┬──────┬────────┐
│ 作業名稱             │ 執行  │ 時長  │ 成本    │
├─────────────────────┼──────┼──────┼────────┤
│ vendor_master_sync  │ 30次 │ 156h │ $45 ⚠️ │
│ material_cost_update│ 30次 │ 89h  │ $28    │
│ quality_check_daily │ 30次 │ 67h  │ $18    │
│ 其他 (12 個作業)     │      │ 124h │ $32    │
├─────────────────────┼──────┼──────┼────────┤
│ 總計                │      │ 436h │ $123   │
└─────────────────────┴──────┴──────┴────────┘

🎯 Top 3 優化建議:

1. vendor_master_sync (預期節省 60%)
   問題: 執行時間過長 (5.2 分鐘/次)
   
   優化方案:
   • 建立索引 → 時長 -65%
   • 增量同步 → 時長 -30%
   
   預期成本: $45 → $18/月
   節省: $27/月
   
   [立即優化]

2. material_cost_update (預期節省 40%)
   問題: 執行時段不佳 (02:35 高峰)
   
   優化方案:
   • 調整排程 → 避開高峰
   • 批次優化 → 時長 -40%
   
   預期成本: $28 → $17/月
   節省: $11/月
   
   [立即優化]

3. 冗餘作業清理 (節省 $8/月)
   發現 3 個作業已無使用:
   • old_sync_job (停用 90 天)
   • test_export (測試用)
   • backup_legacy (已棄用)
   
   [清理作業]

💡 總節省潛力: $46/月 (37%)

[套用所有優化] [生成詳細報告]
```

**價值**: 降低 37% 運營成本

---

#### 14. Schema 演化管理 (Schema Evolution) ⭐

**技術**: Schema Diff / Impact Analysis

**功能**:
- 檢測 Schema 變更
- 分析影響範圍
- 生成遷移腳本

**實際應用**:
```
🤖 AI 檢測到 Schema 變更:

⚠️ vendor_master 新增欄位:
• credit_rating VARCHAR(10)

🔍 影響分析:
下游影響:
• 3 個 ETL 作業:
  - vendor_master_sync (需更新)
  - vendor_analysis_update (需更新)
  - data_export_daily (向後兼容 ✓)

• 2 個報表:
  - vendor_analysis_report (需更新)
  - monthly_vendor_summary (向後兼容 ✓)

• 1 個 API:
  - GET /api/vendors (需更新文件)

風險評估: 🟡 中風險
• 可能影響現有查詢
• 歷史資料需要補填

💡 建議遷移策略:

Phase 1: 準備 (預計 1 天)
✓ 在 clean layer 新增欄位 (允許 NULL)
✓ 更新元數據註冊
✓ 準備測試資料

Phase 2: ETL 更新 (預計 2 天)
✓ 更新 sync 邏輯 (向後兼容)
✓ 執行測試驗證
✓ 監控執行狀況

Phase 3: 資料補填 (預計 3 天)
✓ AI 分析歷史資料
✓ 自動推斷 credit_rating
✓ 人工審核高風險資料

Phase 4: 下游更新 (預計 2 天)
✓ 更新報表定義
✓ 更新 API 文件
✓ 通知相關團隊

總預計時間: 8 天
風險: 可控

📋 自動生成遷移腳本:

```sql
-- Step 1: Add column
ALTER TABLE clean.vendor_master 
ADD COLUMN credit_rating VARCHAR(10);

-- Step 2: Update metadata
INSERT INTO clean._metadata_column (
  table_name, column_name, 
  column_name_cn, data_type, ...
) VALUES (
  'vendor_master', 'credit_rating',
  '信用評等', 'VARCHAR(10)', ...
);

-- Step 3: Update ETL
-- (自動生成 ETL 更新程式碼)

-- Step 4: Data backfill
UPDATE clean.vendor_master
SET credit_rating = 
  CASE 
    WHEN credit_limit > 10000000 THEN 'AAA'
    WHEN credit_limit > 5000000 THEN 'AA'
    ...
  END
WHERE credit_rating IS NULL;
```

[預覽完整計畫] [自動執行遷移] [手動調整]
```

**價值**: 安全的 Schema 演化，降低變更風險

---

### 4.3 可選 AI 功能（有需求再做）

#### 15. 智能資料遮罩 (Data Masking)
- NER 識別敏感欄位
- 自動套用遮罩規則
- 依角色權限管控

#### 16. 智能測試資料生成 (Test Data Generation)
- 保持統計特性
- 保持關聯性
- 生成合規測試資料

#### 17. 智能版本控制 (Version Control)
- Change Data Capture
- 異常變更檢測
- 一鍵回滾

#### 18. 智能資料契約 (Data Contracts)
- SLA 定義與監控
- 契約驗證
- 違約告警

---

## 5. 核心功能模組

### 5.1 智能儀表板 (Dashboard)

#### 5.1.1 系統總覽

**佈局設計**:
```
┌─────────────────────────────────────────────────────┐
│  📊 系統概覽                    [刷新] [自訂配置]     │
├─────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────┐│
│  │ 資料源    │ │ ETL 作業  │ │ 資料品質  │ │ 今日量 ││
│  │  12/15   │ │  45/50   │ │  95.2%  │ │  1.2M  ││
│  │  🟢 80%  │ │  🟢 90%  │ │  🟢 優秀  │ │  +5%   ││
│  │ [詳情]   │ │ [詳情]   │ │ [詳情]   │ │ [詳情] ││
│  └──────────┘ └──────────┘ └──────────┘ └────────┘│
├─────────────────────────────────────────────────────┤
│  📈 即時監控                                          │
│  ┌──────────────────────────┐ ┌──────────────────┐ │
│  │ ETL 執行趨勢 (24小時)      │ │ 品質分數趨勢(7天)│ │
│  │ [ECharts 折線圖]          │ │ [ECharts 折線圖] │ │
│  │ - 可縮放                  │ │ - 多資料表對比   │ │
│  │ - 懸停顯示詳情             │ │ - 點擊深入查看   │ │
│  └──────────────────────────┘ └──────────────────┘ │
├─────────────────────────────────────────────────────┤
│  🚨 告警中心        │  📋 最近執行                    │
│  🔴 3 個嚴重告警    │  ✅ material_master_sync       │
│  🟡 5 個警告        │     2 分鐘前 · 成功             │
│  [查看全部]        │  ❌ vendor_master_sync         │
│                    │     30 分鐘前 · 失敗 · [重試]  │
└────────────────────┴────────────────────────────────┘
```

**互動特性**:
- 所有卡片可點擊深入查看
- 圖表支援縮放、篩選、匯出
- 即時 WebSocket 更新
- 響應式設計（桌面/平板/手機）

---

#### 5.1.2 AI 助手面板

**展開狀態**（右下角）:
```
┌─────────────────────────────────────┐
│  💬 與 AI 對話              [−] [×] │
├─────────────────────────────────────┤
│  🤖: 早安 Irene！今天有 2 個項目需要 │
│      關注：                         │
│                                     │
│  1. vendor_master_sync 失敗了      │
│     → 已自動重試，目前執行中        │
│                                     │
│  2. vendor_master 品質下降 2%      │
│     → 發現 78 rows 格式問題         │
│                                     │
│  需要我協助處理嗎？                 │
│  [查看詳情] [忽略]                  │
│                                     │
├─────────────────────────────────────┤
│  💡 快速操作                         │
│  • 查詢今天的作業狀態                │
│  • 生成品質週報                      │
│  • 重試失敗的作業                    │
│  • 查看異常資料                      │
├─────────────────────────────────────┤
│  ┌───────────────────────────────┐  │
│  │ 問我任何問題... (Enter 發送)  │  │
│  │ Ctrl+K 快速呼叫               │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

**收起狀態**:
```
         ┌──────────┐
         │ 💬 AI 助手│  ← 懸浮右下角
         └──────────┘
           ⚫ 1 則新訊息
```

**特色功能**:
- **上下文感知**: 知道使用者在看哪個頁面
- **主動建議**: 發現問題主動提示
- **快捷鍵**: `Ctrl+K` 全局快速呼叫
- **歷史記錄**: 可查看對話歷史
- **一鍵操作**: 確認後直接執行

---

### 5.2 ETL 作業管理

#### 5.2.1 作業列表

**視圖設計**:
```
┌─────────────────────────────────────────────────────┐
│  ⚙️ ETL 作業管理                      [+ 新增作業]    │
├─────────────────────────────────────────────────────┤
│  🔍 [搜尋]  [狀態▾] [標籤▾]    [列表] [卡片] [甘特圖]│
├─────────────────────────────────────────────────────┤
│  ┌────────────────────────────────────────────────┐ │
│  │ 🟢 material_master_sync              已啟用     │ │
│  │ ERP 物料主檔同步                                │ │
│  │ ⏱️ 每日 02:00  |  ⚡ 平均 2.5 分鐘              │ │
│  │ 最後: 2h前 ✅ 成功 | 1,348 rows                │ │
│  │ 📊 成功率 (30天): ████████████████████ 100%    │ │
│  │ [▶ 執行] [✏️ 編輯] [📋 記錄] [⋮]               │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 🔴 vendor_master_sync                已啟用     │ │
│  │ ERP 廠商主檔同步                                │ │
│  │ ⏱️ 每日 02:30  |  ⚡ 平均 5.2 分鐘 ⚠️ 緩慢      │ │
│  │ 最後: 30m前 ❌ 失敗 | Timeout                  │ │
│  │ 📊 成功率 (30天): █████████████▒▒▒▒▒▒▒ 68%    │ │
│  │ 💡 AI 建議: 需要優化 [查看建議]                 │ │
│  │ [🔄 重試] [✏️ 編輯] [📋 記錄] [⋮]              │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

**功能特性**:
- 多種視圖（列表/卡片/甘特圖）
- 即時狀態更新
- 成功率視覺化（進度條）
- AI 主動建議優化
- 批次操作（選擇多個作業）

---

#### 5.2.2 作業詳情

**深度分析頁面**:
```
┌─────────────────────────────────────────────────────┐
│  ← 返回  vendor_master_sync                [編輯]    │
├─────────────────────────────────────────────────────┤
│  📊 作業概覽                                          │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────┐│
│  │ 成功率    │ │ 平均時長  │ │ 最後執行  │ │ 下次   ││
│  │  68%     │ │  5.2 分   │ │ 30 分前  │ │ 明天   ││
│  │  🔴 低   │ │  ⚠️ 緩慢  │ │  ❌ 失敗  │ │ 02:30  ││
│  └──────────┘ └──────────┘ └──────────┘ └────────┘│
├─────────────────────────────────────────────────────┤
│  📈 執行趨勢 (30 天)                                  │
│  [ECharts 雙軸圖: 執行時長 + 成功率]                  │
│  - 時長從 2.5m 增加到 5.2m (+108%)                   │
│  - 成功率從 100% 下降到 68% (-32%)                   │
├─────────────────────────────────────────────────────┤
│  🤖 AI 分析報告                                       │
│  ⚠️ 發現 3 個問題:                                    │
│                                                      │
│  1. 執行時間持續增加 (+108%)                         │
│     根因: 資料量增長 + 缺少索引                       │
│     影響: 後續作業延遲                                │
│                                                      │
│  2. 成功率下降 (-32%)                                │
│     根因: 連線超時 60%、記憶體不足 30%               │
│     影響: 資料同步不完整                              │
│                                                      │
│  3. 資源使用率高 (CPU 85%, Memory 92%)               │
│     根因: 批次大小過大                                │
│     影響: 影響其他作業                                │
│                                                      │
│  💡 優化建議:                                         │
│  ┌────────────────────────────────────────────────┐ │
│  │ ✅ 高優先級 (預期提升 65%)                        │ │
│  │   • 建立索引 pmc01, pmc02                       │ │
│  │   • 增加超時時間 30s → 60s                       │ │
│  │   • 調整批次大小 1000 → 500                      │ │
│  │                                                  │ │
│  │ 預期結果:                                         │ │
│  │ 時長: 5.2m → 1.8m (-65%)                        │ │
│  │ 成功率: 68% → 98% (+30%)                        │ │
│  │                                                  │ │
│  │ [🚀 一鍵優化] [✏️ 手動調整] [❌ 忽略]            │ │
│  └────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────┤
│  📋 執行歷史                            [匯出] [篩選] │
│  [表格: 時間/狀態/時長/行數/錯誤/操作]                │
│  [分頁: 1 2 3 ... 10]                               │
└─────────────────────────────────────────────────────┘
```

**一鍵優化功能**:
```
點擊 [🚀 一鍵優化]:

┌─────────────────────────────────────┐
│  🚀 正在優化 vendor_master_sync      │
├─────────────────────────────────────┤
│  ✅ 已增加連線超時時間                │
│  ✅ 已調整批次大小                    │
│  ✅ 已調整排程時間                    │
│  🔄 正在建立索引建議... 75%           │
│  ━━━━━━━━━━━━━▒▒▒▒▒                │
│                                     │
│  預計完成: 15 秒                     │
└─────────────────────────────────────┘

完成後:
✅ 優化完成！
   已套用 3 項建議
   索引建議已記錄 (需 DBA 執行)
   
   下次執行將應用新設定
   我會監控效果並通知你
```

---

### 5.3 資料品質管理

#### 5.3.1 品質總覽

```
┌─────────────────────────────────────────────────────┐
│  ✅ 資料品質管理                                      │
├─────────────────────────────────────────────────────┤
│  📊 品質總覽                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌─────────────┐ │
│  │ 整體評分      │ │ 未解決問題    │ │ 檢查次數    │ │
│  │   95.2%     │ │     12       │ │    150      │ │
│  │  🟢 EXCELLENT│ │  🔴3 🟡9     │ │  (本週)     │ │
│  │  ▲ +1.3%    │ │  ▼ +2        │ │  ▲ +10      │ │
│  └──────────────┘ └──────────────┘ └─────────────┘ │
├─────────────────────────────────────────────────────┤
│  📈 品質趨勢 (7 天) - [ECharts 多線圖]                │
│  vendor_master:    ──────◄ 92.5% 🟢                │
│  material_master:  ─────◄ 98.1% 🟢                 │
│  tax_code_master:  ────◄ 87.3% 🟡                  │
│                                                      │
│  💡 vendor_master 趨勢下降 -2.1%，需關注              │
├─────────────────────────────────────────────────────┤
│  📊 資料表品質分布 - [環形圖]                         │
│  PERFECT (98-100%)    ████ 3 張表                   │
│  EXCELLENT (95-97%)   ███  2 張表                   │
│  GOOD (80-94%)        ██   1 張表                   │
│  POOR (<80%)          █    1 張表                   │
├─────────────────────────────────────────────────────┤
│  🔍 品質問題 (按嚴重性)              [篩選] [匯出]    │
│  ┌────────────────────────────────────────────────┐ │
│  │ 🔴 CRITICAL | vendor_master.tax_number         │ │
│  │ 空值比例過高 15.2% | 影響 1,517 rows            │ │
│  │ 趨勢: ↗ 惡化中                                  │ │
│  │ [查看詳情] [🔧 AI 修復] [👤 指派]              │ │
│  └────────────────────────────────────────────────┘ │
│  ...                                                 │
└─────────────────────────────────────────────────────┘
```

---

#### 5.3.2 資料表品質詳情

```
┌─────────────────────────────────────────────────────┐
│  ← 返回  vendor_master 品質分析                       │
├─────────────────────────────────────────────────────┤
│  📊 整體評分: 92.5% 🟢 EXCELLENT                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━          │
│  █████████████████████████████████▒▒▒▒▒▒           │
│  趨勢: ▼ -2.1% (vs 昨天 94.6%)                      │
├─────────────────────────────────────────────────────┤
│  🎯 品質維度分析 - [雷達圖]                           │
│  完整性: 87.5% 🟡 (主要問題)                         │
│  準確性: 98.2% 🟢                                    │
│  一致性: 96.8% 🟢                                    │
│  即時性: 92.1% 🟢                                    │
│  有效性: 94.5% 🟢                                    │
│  合規性: 100%  🟢                                    │
├─────────────────────────────────────────────────────┤
│  ⚠️ 品質問題列表 (3 個)                               │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 🔴 CRITICAL | tax_number                       │ │
│  │ 問題: 空值比例過高 15.2%                        │ │
│  │ 影響: 1,517 / 9,972 rows                       │ │
│  │ 趨勢: [小型折線圖] 持續惡化                     │ │
│  │                                                │ │
│  │ 🤖 AI 根因分析:                                 │ │
│  │ 1. 來源系統未強制填寫                           │ │
│  │ 2. 新增廠商流程缺少驗證                         │ │
│  │ 3. 歷史資料未補齊                               │ │
│  │                                                │ │
│  │ 🤖 AI 修復方案:                                 │ │
│  │ • 自動推斷 1,289 筆 (85%) - 信心度 95%         │ │
│  │ • 人工確認 228 筆 (15%)                         │ │
│  │ • 預期品質提升: 87.5% → 98.2%                  │ │
│  │                                                │ │
│  │ [🔧 一鍵修復] [📋 查看資料] [👤 指派處理]       │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 🟡 WARNING | bank_account                      │ │
│  │ 問題: 格式不統一                                │ │
│  │ 影響: 78 / 9,972 rows (0.8%)                   │ │
│  │                                                │ │
│  │ 格式分布: [圓餅圖]                              │ │
│  │ • 16碼數字  92% ✅                              │ │
│  │ • 含橫線    5%                                  │ │
│  │ • 含空格    2%                                  │ │
│  │ • 其他      1%                                  │ │
│  │                                                │ │
│  │ 🤖 建議: 統一為 16 碼數字格式                   │ │
│  │ [🔧 一鍵修復] [📋 查看資料]                     │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

---

### 5.4 元數據管理

#### 5.4.1 元數據瀏覽器

```
┌─────────────────────────────────────────────────────┐
│  📚 元數據管理                                        │
├─────────────────────────────────────────────────────┤
│  🔍 [搜尋資料表或欄位...]                             │
│  [Layer: 全部▾] [System: 全部▾] [標籤篩選]          │
├─────────────────────────────────────────────────────┤
│  📊 資料表總覽                                        │
│  Source Layer: 55 張表                               │
│  Clean Layer:  7 張表                                │
│  Mart Layer:   0 張表                                │
├─────────────────────────────────────────────────────┤
│  🗂️ Clean Layer                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 📋 vendor_master                               │ │
│  │ 廠商主檔 | ERP系統 | 每日更新                   │ │
│  │                                                │ │
│  │ 基本資訊:                                       │ │
│  │ • 9,972 rows, 43 columns                       │ │
│  │ • 主鍵: vendor_id                              │ │
│  │ • 最後更新: 2 小時前                            │ │
│  │                                                │ │
│  │ 品質狀態:                                       │ │
│  │ • 品質評分: 92.5% 🟢                           │ │
│  │ • 未解決問題: 3 個                              │ │
│  │                                                │ │
│  │ 血緣關係:                                       │ │
│  │ • 上游: erp_m2201_pmc_file                     │ │
│  │ • 下游: 2 個表                                  │ │
│  │                                                │ │
│  │ [查看欄位] [查看血緣] [編輯元數據] [⋮]         │ │
│  └────────────────────────────────────────────────┘ │
│  ...                                                 │
└─────────────────────────────────────────────────────┘
```

---

#### 5.4.2 欄位管理

```
┌─────────────────────────────────────────────────────┐
│  ← 返回  vendor_master - 欄位管理           [+ 新增] │
├─────────────────────────────────────────────────────┤
│  🔍 [搜尋欄位...]  [全部▾] [只顯示未填描述]          │
├─────────────────────────────────────────────────────┤
│  43 個欄位 | 完整性: 100%                             │
│  💡 AI 可自動生成未填的欄位描述 [一鍵生成]            │
├─────────────────────────────────────────────────────┤
│  ┌────────────────────────────────────────────────┐ │
│  │ vendor_id                                      │ │
│  │ 🏷️ 廠商編號 | VARCHAR(20) | 主鍵 | 必填         │ │
│  │                                                │ │
│  │ 描述:                                           │ │
│  │ 唯一識別碼，格式為 V + 3位數字 (V001-V999)      │ │
│  │                                                │ │
│  │ 範例值: V001, V002, V123                        │ │
│  │ 完整率: 100% | 唯一性: 100%                     │ │
│  │                                                │ │
│  │ 標籤: #主鍵 #識別碼                             │ │
│  │                                                │ │
│  │ [編輯] [查看血緣] [查看品質]                    │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ tax_number                                     │ │
│  │ 🏷️ 統一編號 | VARCHAR(8) | 可空                │ │
│  │                                                │ │
│  │ 描述: (未填) 🤖 [AI 自動生成]                   │ │
│  │                                                │ │
│  │ 🤖 AI 建議描述:                                 │
│  │ "公司統一編號，台灣公司的 8 碼數字識別碼"        │ │
│  │ 信心度: 95%                                     │ │
│  │ [套用] [編輯] [重新生成]                        │ │
│  │                                                │ │
│  │ 範例值: "12345678", "87654321"                  │ │
│  │ 完整率: 84.8% (1,517 筆空值) ⚠️                 │ │
│  │ 格式符合率: 98.2%                               │ │
│  │                                                │ │
│  │ 標籤: #敏感資料 #業務關鍵                       │ │
│  │                                                │ │
│  │ [編輯] [查看血緣] [查看品質]                    │ │
│  └────────────────────────────────────────────────┘ │
│  ...                                                 │
└─────────────────────────────────────────────────────┘
```

---

#### 5.4.3 資料血緣圖

```
┌─────────────────────────────────────────────────────┐
│  🔗 資料血緣追蹤                      [全螢幕] [匯出]  │
├─────────────────────────────────────────────────────┤
│  [D3.js 互動式血緣圖]                                 │
│                                                      │
│  Source Layer        Clean Layer       Mart Layer   │
│                                                      │
│  ┌──────────┐       ┌───────────┐    ┌──────────┐ │
│  │ ERP      │──────▶│ material_ │───▶│ monthly_ │ │
│  │ m2201_   │       │ master    │    │ sales    │ │
│  │ ima_file │       └───────────┘    └──────────┘ │
│  └──────────┘             │                        │
│                            │                        │
│  ┌──────────┐             │          ┌──────────┐ │
│  │ ERP      │──────▶┌────▼──────┐───▶│ vendor_  │ │
│  │ m2201_   │       │ vendor_   │    │ analysis │ │
│  │ pmc_file │       │ master    │◄── 點擊這裡    │ │
│  └──────────┘       └───────────┘    └──────────┘ │
│                                                      │
│  [互動功能]                                          │
│  • 點擊節點查看詳情                                  │
│  • 拖曳調整位置                                      │
│  • 滑鼠懸停顯示轉換邏輯                              │
│  • 篩選特定資料表                                    │
│  • 縮放與平移                                        │
└─────────────────────────────────────────────────────┘

[點擊 vendor_master 節點後，右側彈出詳情面板]

┌─────────────────────────────────────┐
│  📊 vendor_master 詳情               │
├─────────────────────────────────────┤
│  Layer: Clean                       │
│  來源: erp_m2201_pmc_file           │
│  下游: 2 個表                        │
│                                     │
│  轉換邏輯:                           │
│  • 43 個欄位對應                     │
│  • 4 層清理流程                      │
│  • 3 個驗證規則                      │
│                                     │
│  欄位對應範例:                       │
│  pmc01 → vendor_id                  │
│  pmc02 → vendor_name (清理空白)     │
│  pmc03 → tax_number (格式化)        │
│  ...                                │
│                                     │
│  更新資訊:                           │
│  • 最後更新: 2 小時前                │
│  • 更新頻率: 每日                    │
│  • 平均時長: 5.2 分鐘                │
│                                     │
│  品質狀態:                           │
│  • 品質評分: 92.5% 🟢               │
│  • 未解決問題: 3 個                  │
│                                     │
│  [查看詳細對應] [查看轉換SQL]        │
│  [查看品質報告] [編輯元數據]         │
└─────────────────────────────────────┘
```

---

### 5.5 自然語言查詢介面

```
┌─────────────────────────────────────────────────────┐
│  🔍 智能查詢                              [新對話]    │
├─────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────┐  │
│  │ 用自然語言問任何問題...                        │  │
│  │                                               │  │
│  │ 💡 試試這些問題:                               │  │
│  │ • 今天有哪些作業失敗了？                       │  │
│  │ • vendor_master 的品質評分是多少？            │  │
│  │ • 給我看最近 7 天的 ETL 執行趨勢               │  │
│  │ • 哪個資料表問題最多？                         │  │
│  │ • 分析為什麼 vendor_master 品質下降了         │  │
│  └───────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────┤
│  💬 對話歷史                              [清除]     │
│                                                      │
│  👤: vendor_master 最近 30 天的品質趨勢如何？       │
│                                                      │
│  🤖: [自動生成視覺化報告]                            │
│                                                      │
│     ┌────────────────────────────────────────────┐  │
│     │ 📊 vendor_master 品質趨勢 (30天)           │  │
│     ├────────────────────────────────────────────┤  │
│     │ [ECharts 折線圖]                           │  │
│     │ 100% ┐                                     │  │
│     │  95% ├ ──────────╲                         │  │
│     │  90% ┤            ╲────────◄ 當前 92.5%   │  │
│     │  85% ┤                                     │  │
│     │      └─────────────────────                │  │
│     │       30天前    15天前     今天             │  │
│     │                                            │  │
│     │ 主要變化:                                   │  │
│     │ • 2/1: 下降 3% (96%→93%)                  │  │
│     │ • 2/8: 持續下降 (93%→92.5%)               │  │
│     │                                            │  │
│     │ 🔍 根因分析:                                │  │
│     │ 1. tax_number 空值率上升 (12%→15%)        │  │
│     │ 2. bank_account 格式不統一 (+33 rows)     │  │
│     │ 3. 資料更新頻率降低                         │  │
│     │                                            │  │
│     │ 💡 修復建議:                                │  │
│     │ [🔧 自動修復 tax_number (預期 +2%)]       │  │
│     │ [🔧 統一 bank_account (預期 +0.5%)]       │  │
│     │ [⚙️ 優化 ETL 作業 (預期 +0.8%)]           │  │
│     └────────────────────────────────────────────┘  │
│                                                      │
│  👤: 自動修復 tax_number                             │
│                                                      │
│  🤖: 🔧 修復方案預覽:                                │
│                                                      │
│     分析了 1,517 筆空值資料                          │
│     ✓ 1,289 筆 (85%) 可自動推斷                     │
│     ⚠️ 228 筆 (15%) 需人工確認                       │
│                                                      │
│     預期品質提升: 87.5% → 98.2%                     │
│                                                      │
│     確認執行嗎？                                     │
│     [✅ 確認修復] [📋 預覽結果] [❌ 取消]            │
│                                                      │
│  👤: 確認修復                                        │
│                                                      │
│  🤖: ✅ 修復完成！                                   │
│                                                      │
│     已修復 1,289 筆資料                              │
│     已產生 228 筆待人工確認清單                      │
│     品質評分更新: 87.5% → 98.2% ✨                  │
│                                                      │
│     [查看修復詳情] [查看待確認清單]                  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**特色功能**:
- 理解複雜自然語言查詢
- 自動生成視覺化報表
- 支援後續追問（上下文連貫）
- 可直接執行操作（經確認）
- 對話歷史可儲存與搜尋

---

## 6. Metadata 整合方案

### 6.1 現有 7 張 Metadata 表

#### 表 1: _metadata_table (資料表註冊)
```sql
SELECT 
  table_name,           -- 資料表名稱
  table_name_cn,        -- 中文名稱
  description,          -- 描述
  layer,                -- 層級 (source/clean/mart)
  source_system,        -- 來源系統
  row_count,            -- 行數
  column_count,         -- 欄位數
  created_at,           -- 建立時間
  is_active             -- 是否啟用
FROM clean._metadata_table;
```

**整合用途**:
- 元數據瀏覽器（資料表列表）
- 儀表板統計（資料表數量）
- 搜尋與篩選

---

#### 表 2: _metadata_column (欄位定義)
```sql
SELECT 
  table_name,           -- 所屬資料表
  column_name,          -- 欄位名稱
  column_name_cn,       -- 中文名稱
  data_type,            -- 資料類型
  is_nullable,          -- 是否可空
  is_primary_key,       -- 是否主鍵
  default_value,        -- 預設值
  description,          -- 描述
  example_values,       -- 範例值
  business_category,    -- 業務分類
  is_sensitive          -- 是否敏感
FROM clean._metadata_column;
```

**整合用途**:
- 欄位管理頁面
- 資料字典導出
- AI 自動生成元數據（補充空缺）

---

#### 表 3: _metadata_column_mapping (血緣對應)
```sql
SELECT 
  source_table,         -- 來源資料表
  source_column,        -- 來源欄位
  target_table,         -- 目標資料表
  target_column,        -- 目標欄位
  transformation_logic, -- 轉換邏輯
  created_at
FROM clean._metadata_column_mapping;
```

**整合用途**:
- 血緣追蹤（D3.js 圖）
- 欄位級血緣（桑基圖）
- 影響分析

---

#### 表 4: _cleansing_log (清理日誌)
```sql
SELECT 
  table_name,
  column_name,
  fix_level,            -- 清理層級 (1-4)
  fix_type,             -- 清理類型
  original_value,       -- 原始值
  cleaned_value,        -- 清理後值
  batch_id,
  created_at
FROM clean._cleansing_log;
```

**整合用途**:
- 清理歷史查詢
- AI 學習清理模式
- 清理統計分析

---

#### 表 5: _metadata_cleansing_rules (清理規則)
```sql
SELECT 
  table_name,
  column_name,
  fix_level,
  rule_logic,           -- 規則邏輯
  is_active,
  created_at
FROM clean._metadata_cleansing_rules;
```

**整合用途**:
- 清理規則管理
- AI 自動推薦規則
- 規則效能分析

---

#### 表 6: _metadata_validation_rules (驗證規則)
```sql
SELECT 
  table_name,
  column_name,
  rule_type,            -- NOT_NULL, UNIQUE, RANGE, PATTERN, etc.
  rule_expression,      -- 規則表達式
  severity,             -- CRITICAL, WARNING, INFO
  is_active,
  created_at
FROM clean._metadata_validation_rules;
```

**整合用途**:
- 品質檢查配置
- 品質規則管理
- 自動執行驗證

---

#### 表 7: _metadata_quality_checks (品質檢查記錄)
```sql
SELECT 
  check_id,
  table_name,
  check_time,
  registration_rate,    -- 欄位註冊率
  quality_score,        -- 品質評分
  quality_grade,        -- 評級
  open_issue_count,     -- 未解決問題數
  critical_issue_count, -- 嚴重問題數
  warning_issue_count,  -- 警告問題數
  check_details         -- 檢查詳情 JSONB
FROM clean._metadata_quality_checks;
```

**整合用途**:
- 品質趨勢分析
- 品質儀表板
- 歷史追蹤

---

### 6.2 整合架構

**方式: API 層統一存取（推薦）**

```javascript
// DGP 後端 - Metadata Service

class MetadataService {
  constructor() {
    // 連接到 source database
    this.sourceDb = new PrismaClient({
      datasources: {
        db: {
          url: 'postgresql://myuser:mypassword@etldatalake-public...rds.amazonaws.com:5432/source'
        }
      }
    });
  }

  // 查詢資料表列表
  async getTables(filters = {}) {
    const { layer, sourceSystem, isActive = true } = filters;
    
    return await this.sourceDb.$queryRaw`
      SELECT 
        table_name,
        table_name_cn,
        description,
        layer,
        source_system,
        row_count,
        column_count,
        created_at
      FROM clean._metadata_table
      WHERE is_active = ${isActive}
        ${layer ? Prisma.sql`AND layer = ${layer}` : Prisma.empty}
        ${sourceSystem ? Prisma.sql`AND source_system = ${sourceSystem}` : Prisma.empty}
      ORDER BY table_name
    `;
  }

  // 查詢資料表詳情（含欄位）
  async getTableDetail(tableName) {
    const table = await this.sourceDb.$queryRaw`
      SELECT * FROM clean._metadata_table
      WHERE table_name = ${tableName}
    `;

    const columns = await this.sourceDb.$queryRaw`
      SELECT * FROM clean._metadata_column
      WHERE table_name = ${tableName}
      ORDER BY ordinal_position
    `;

    const latestQuality = await this.sourceDb.$queryRaw`
      SELECT * FROM clean._metadata_quality_checks
      WHERE table_name = ${tableName}
      ORDER BY check_time DESC
      LIMIT 1
    `;

    return {
      ...table[0],
      columns,
      quality: latestQuality[0]
    };
  }

  // 查詢血緣關係
  async getLineage(tableName, direction = 'both') {
    // direction: 'upstream', 'downstream', 'both'
    
    if (direction === 'both' || direction === 'upstream') {
      const upstream = await this.sourceDb.$queryRaw`
        SELECT * FROM clean._metadata_column_mapping
        WHERE target_table = ${tableName}
      `;
    }

    if (direction === 'both' || direction === 'downstream') {
      const downstream = await this.sourceDb.$queryRaw`
        SELECT * FROM clean._metadata_column_mapping
        WHERE source_table = ${tableName}
      `;
    }

    // 轉換為圖形格式
    return this.convertToGraphFormat(upstream, downstream);
  }

  // 查詢品質趨勢
  async getQualityTrend(tableName, days = 7) {
    return await this.sourceDb.$queryRaw`
      SELECT 
        check_time,
        quality_score,
        registration_rate,
        open_issue_count
      FROM clean._metadata_quality_checks
      WHERE table_name = ${tableName}
        AND check_time >= NOW() - INTERVAL '${days} days'
      ORDER BY check_time ASC
    `;
  }

  // 查詢清理日誌
  async getCleansingLog(tableName, columnName = null, limit = 100) {
    return await this.sourceDb.$queryRaw`
      SELECT *
      FROM clean._cleansing_log
      WHERE table_name = ${tableName}
        ${columnName ? Prisma.sql`AND column_name = ${columnName}` : Prisma.empty}
      ORDER BY created_at DESC
      LIMIT ${limit}
    `;
  }

  // AI 學習清理模式
  async learnCleansingPatterns(tableName, days = 90) {
    const patterns = await this.sourceDb.$queryRaw`
      SELECT 
        table_name,
        column_name,
        fix_level,
        fix_type,
        COUNT(*) as frequency,
        ARRAY_AGG(DISTINCT original_value) as original_values,
        ARRAY_AGG(DISTINCT cleaned_value) as cleaned_values
      FROM clean._cleansing_log
      WHERE table_name = ${tableName}
        AND created_at >= NOW() - INTERVAL '${days} days'
      GROUP BY table_name, column_name, fix_level, fix_type
      HAVING COUNT(*) > 10
      ORDER BY frequency DESC
    `;

    // 傳給 AI 分析
    return await aiService.suggestCleansingRules(patterns);
  }
}

// Express API 端點
app.get('/api/metadata/tables', async (req, res) => {
  const tables = await metadataService.getTables(req.query);
  res.json(tables);
});

app.get('/api/metadata/tables/:tableName', async (req, res) => {
  const detail = await metadataService.getTableDetail(req.params.tableName);
  res.json(detail);
});

app.get('/api/metadata/tables/:tableName/lineage', async (req, res) => {
  const lineage = await metadataService.getLineage(
    req.params.tableName,
    req.query.direction
  );
  res.json(lineage);
});

app.get('/api/metadata/tables/:tableName/quality-trend', async (req, res) => {
  const trend = await metadataService.getQualityTrend(
    req.params.tableName,
    parseInt(req.query.days || 7)
  );
  res.json(trend);
});
```

### 6.3 整合優點

✅ **即時性**: 直接讀取，無同步延遲  
✅ **一致性**: 單一資料來源  
✅ **靈活性**: 可隨時調整查詢邏輯  
✅ **解耦**: 前端不需要知道資料庫結構  
✅ **擴展性**: 未來可加入快取、權限控制等

---

## 7. Skills 架構設計

### 7.1 Skills 價值

**問題**: 每次 LLM 呼叫需要大量 Token

```
典型查詢: "vendor_master 的品質如何？"

❌ 不使用 Skills:
Input tokens:  ~2,000 (完整上下文)
Output tokens: ~500
成本: $0.03

✅ 使用 Skills:
Input tokens:  ~200 (僅意圖識別)
Output tokens: ~100 (格式化)
成本: $0.005

節省: 83% 💰
```

### 7.2 Skills 目錄結構

```
dgp/
├── skills/
│   ├── quality_check/
│   │   ├── SKILL.md          # 技能說明
│   │   ├── check_table.js    # 查詢資料表品質
│   │   ├── check_column.js   # 查詢欄位品質
│   │   └── trend_analysis.js # 品質趨勢分析
│   │
│   ├── metadata_query/
│   │   ├── SKILL.md
│   │   ├── get_table_info.js      # 取得資料表資訊
│   │   ├── get_lineage.js         # 取得血緣關係
│   │   ├── search_columns.js      # 搜尋欄位
│   │   └── get_table_stats.js     # 取得統計資訊
│   │
│   ├── etl_operations/
│   │   ├── SKILL.md
│   │   ├── run_job.js             # 執行作業
│   │   ├── retry_job.js           # 重試作業
│   │   ├── get_job_status.js     # 取得作業狀態
│   │   └── get_job_history.js    # 取得作業歷史
│   │
│   ├── data_profiling/
│   │   ├── SKILL.md
│   │   ├── profile_table.js       # 剖析資料表
│   │   └── detect_anomalies.js   # 檢測異常
│   │
│   ├── data_exploration/
│   │   ├── SKILL.md
│   │   ├── discover_patterns.js   # 發現模式
│   │   └── find_correlations.js  # 找關聯
│   │
│   └── cost_analysis/
│       ├── SKILL.md
│       ├── analyze_job_cost.js    # 分析作業成本
│       └── suggest_optimization.js # 建議優化
│
└── skills.json  # Skills 註冊表
```

### 7.3 Skills 實現範例

#### skills.json (註冊表)
```json
{
  "version": "1.0",
  "skills": [
    {
      "id": "quality_check",
      "name": "品質檢查",
      "description": "查詢資料品質相關資訊",
      "triggers": [
        "品質",
        "quality",
        "評分",
        "問題",
        "完整性",
        "空值"
      ],
      "functions": [
        {
          "name": "check_table",
          "description": "查詢資料表品質",
          "file": "quality_check/check_table.js",
          "parameters": {
            "table_name": {
              "type": "string",
              "required": true,
              "description": "資料表名稱"
            }
          },
          "examples": [
            "vendor_master 的品質如何？",
            "檢查 vendor_master 品質",
            "vendor_master 品質評分"
          ]
        },
        {
          "name": "trend_analysis",
          "description": "分析品質趨勢",
          "file": "quality_check/trend_analysis.js",
          "parameters": {
            "table_name": {
              "type": "string",
              "required": true
            },
            "days": {
              "type": "integer",
              "default": 7,
              "description": "分析天數"
            }
          },
          "examples": [
            "vendor_master 最近 7 天的品質趨勢",
            "給我看 vendor_master 30 天品質變化"
          ]
        }
      ]
    },
    {
      "id": "metadata_query",
      "name": "元數據查詢",
      "description": "查詢資料表、欄位等元數據",
      "triggers": [
        "資料表",
        "欄位",
        "table",
        "column",
        "元數據",
        "metadata",
        "有哪些"
      ],
      "functions": [
        {
          "name": "get_table_info",
          "description": "取得資料表資訊",
          "file": "metadata_query/get_table_info.js",
          "parameters": {
            "table_name": {
              "type": "string",
              "required": true
            }
          },
          "examples": [
            "vendor_master 有哪些欄位？",
            "vendor_master 的資訊",
            "告訴我 vendor_master 的詳情"
          ]
        }
      ]
    },
    {
      "id": "etl_operations",
      "name": "ETL 操作",
      "description": "執行、重試、查詢 ETL 作業",
      "triggers": [
        "作業",
        "job",
        "ETL",
        "執行",
        "重試",
        "失敗",
        "成功"
      ],
      "functions": [
        {
          "name": "get_failed_jobs",
          "description": "取得失敗的作業",
          "file": "etl_operations/get_failed_jobs.js",
          "parameters": {
            "date": {
              "type": "string",
              "default": "today",
              "description": "日期 (today/yesterday/YYYY-MM-DD)"
            }
          },
          "examples": [
            "今天有哪些作業失敗了？",
            "昨天失敗的作業",
            "列出失敗的 ETL"
          ]
        },
        {
          "name": "retry_job",
          "description": "重試作業",
          "file": "etl_operations/retry_job.js",
          "parameters": {
            "job_id": {
              "type": "string",
              "required": true
            }
          },
          "examples": [
            "重試 vendor_master_sync",
            "重新執行這個作業"
          ]
        }
      ]
    }
  ]
}
```

#### quality_check/check_table.js
```javascript
/**
 * 查詢資料表品質
 */
async function checkTable({ table_name }) {
  try {
    // 直接查詢資料庫
    const result = await db.query(`
      SELECT 
        table_name,
        registration_rate,
        quality_score,
        quality_grade,
        open_issue_count,
        critical_issue_count,
        warning_issue_count,
        check_time
      FROM clean._metadata_quality_checks
      WHERE table_name = $1
      ORDER BY check_time DESC
      LIMIT 1
    `, [table_name]);
    
    if (!result.rows.length) {
      return {
        success: false,
        error: `找不到資料表 ${table_name} 的品質檢查記錄`
      };
    }
    
    const data = result.rows[0];
    
    // 格式化回應（使用簡單範本，不需要 LLM）
    return {
      success: true,
      data: {
        table_name: data.table_name,
        quality_score: data.quality_score,
        grade: data.quality_grade,
        registration_rate: data.registration_rate,
        issues: {
          total: data.open_issue_count,
          critical: data.critical_issue_count,
          warning: data.warning_issue_count
        },
        checked_at: data.check_time
      },
      // 預定義回應範本
      response_template: `
📊 ${data.table_name} 品質報告

品質評分: ${data.quality_score}% ${getGradeEmoji(data.quality_grade)}
評級: ${getGradeText(data.quality_grade)}
欄位註冊率: ${data.registration_rate}%

未解決問題: ${data.open_issue_count} 個
• 🔴 嚴重: ${data.critical_issue_count} 個
• 🟡 警告: ${data.warning_issue_count} 個

最後檢查: ${formatTime(data.check_time)}

${data.open_issue_count > 0 ? '[查看問題詳情] [AI 修復]' : ''}
      `
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}

// 輔助函數
function getGradeEmoji(grade) {
  const map = {
    'PERFECT': '🟢',
    'EXCELLENT': '🟢',
    'GOOD': '🟡',
    'POOR': '🔴'
  };
  return map[grade] || '';
}

function getGradeText(grade) {
  const map = {
    'PERFECT': '完美',
    'EXCELLENT': '優秀',
    'GOOD': '良好',
    'POOR': '需改進'
  };
  return map[grade] || grade;
}

function formatTime(timestamp) {
  const now = new Date();
  const then = new Date(timestamp);
  const diffMs = now - then;
  const diffMins = Math.floor(diffMs / 60000);
  
  if (diffMins < 60) {
    return `${diffMins} 分鐘前`;
  } else if (diffMins < 1440) {
    return `${Math.floor(diffMins / 60)} 小時前`;
  } else {
    return `${Math.floor(diffMins / 1440)} 天前`;
  }
}

module.exports = { checkTable };
```

### 7.4 AI Gateway 整合

```javascript
/**
 * AI Gateway - 處理使用者訊息
 */
class AIGateway {
  constructor() {
    this.skillsRegistry = require('../skills.json');
    this.skillFunctions = this.loadSkillFunctions();
  }

  async handleMessage(message, context) {
    // 1. 意圖識別（輕量級 LLM 呼叫）
    const intent = await this.identifyIntent(message);
    
    // 2. 檢查是否有對應的 Skill
    const skill = this.findMatchingSkill(intent);
    
    if (skill) {
      // 3. 使用 Skill 執行（不需要完整 LLM）
      const result = await this.executeSkill(skill, intent.parameters);
      
      // 4. 格式化回應
      const response = this.formatSkillResponse(result);
      
      return {
        response,
        tokensUsed: {
          input: 200,   // 只需要意圖識別
          output: 100   // 簡單格式化
        },
        usedSkill: true,
        skillId: skill.id
      };
    } else {
      // 5. 無 Skill，使用完整 LLM 處理
      const response = await this.callLLM(message, context);
      
      return {
        response,
        tokensUsed: {
          input: 2000,  // 完整上下文
          output: 500
        },
        usedSkill: false
      };
    }
  }

  /**
   * 意圖識別（輕量級）
   */
  async identifyIntent(message) {
    const prompt = `
你是意圖識別助手。分析使用者訊息，判斷意圖和參數。

訊息: "${message}"

可用 Skills:
${this.getSkillsPrompt()}

回應 JSON 格式:
{
  "intent": "skill_id.function_name",
  "parameters": { ... },
  "confidence": 0.95
}

如果無匹配 Skill，回應:
{
  "intent": "unknown",
  "confidence": 0.0
}
    `;
    
    const response = await claude.complete(prompt, {
      maxTokens: 150,
      temperature: 0,
      model: 'claude-3-haiku' // 使用最便宜的模型
    });
    
    return JSON.parse(response);
  }

  /**
   * 找到匹配的 Skill
   */
  findMatchingSkill(intent) {
    if (intent.intent === 'unknown' || intent.confidence < 0.7) {
      return null;
    }
    
    const [skillId, functionName] = intent.intent.split('.');
    
    const skill = this.skillsRegistry.skills.find(s => s.id === skillId);
    if (!skill) return null;
    
    const func = skill.functions.find(f => f.name === functionName);
    if (!func) return null;
    
    return {
      id: skillId,
      function: func,
      parameters: intent.parameters
    };
  }

  /**
   * 執行 Skill
   */
  async executeSkill(skill, parameters) {
    const funcModule = this.skillFunctions[skill.id][skill.function.name];
    
    if (!funcModule) {
      throw new Error(`Skill function not found: ${skill.id}.${skill.function.name}`);
    }
    
    // 執行 Skill 函數
    const result = await funcModule(parameters);
    
    return result;
  }

  /**
   * 格式化 Skill 回應
   */
  formatSkillResponse(result) {
    if (!result.success) {
      return `❌ ${result.error}`;
    }
    
    // 如果有預定義範本，使用範本
    if (result.response_template) {
      return result.response_template;
    }
    
    // 否則使用預設格式化
    return JSON.stringify(result.data, null, 2);
  }

  /**
   * 呼叫完整 LLM（無 Skill 時）
   */
  async callLLM(message, context) {
    const prompt = `
${context.systemPrompt}

對話歷史:
${context.history.map(h => `${h.role}: ${h.content}`).join('\n')}

使用者: ${message}

請回應:
    `;
    
    const response = await claude.complete(prompt, {
      maxTokens: 1000,
      temperature: 0.7,
      model: 'claude-3-5-sonnet-20241022'
    });
    
    return response;
  }

  /**
   * 載入所有 Skill 函數
   */
  loadSkillFunctions() {
    const functions = {};
    
    this.skillsRegistry.skills.forEach(skill => {
      functions[skill.id] = {};
      
      skill.functions.forEach(func => {
        const modulePath = path.join(__dirname, '../skills', func.file);
        functions[skill.id][func.name] = require(modulePath);
      });
    });
    
    return functions;
  }

  /**
   * 生成 Skills 提示詞
   */
  getSkillsPrompt() {
    return this.skillsRegistry.skills.map(skill => {
      const funcs = skill.functions.map(f => 
        `  - ${f.name}: ${f.description}`
      ).join('\n');
      
      return `
${skill.id} (${skill.name}):
${funcs}
觸發詞: ${skill.triggers.join(', ')}
      `.trim();
    }).join('\n\n');
  }
}

// Express API
app.post('/api/ai/chat', async (req, res) => {
  const { message, context } = req.body;
  
  const aiGateway = new AIGateway();
  const result = await aiGateway.handleMessage(message, context);
  
  res.json(result);
});
```

### 7.5 Token 節省分析

#### 場景覆蓋率預估

| 查詢類型 | 範例 | 可用 Skill | 覆蓋率 |
|---------|------|-----------|-------|
| 品質查詢 | "vendor_master 品質如何？" | ✅ quality_check | 20% |
| 元數據查詢 | "vendor_master 有哪些欄位？" | ✅ metadata_query | 15% |
| ETL 操作 | "今天哪些作業失敗了？" | ✅ etl_operations | 25% |
| 資料剖析 | "分析 vendor_master" | ✅ data_profiling | 10% |
| 探索洞察 | "發現有趣的模式" | ✅ data_exploration | 5% |
| 成本分析 | "哪個作業最貴？" | ✅ cost_analysis | 5% |
| 複雜分析 | "為什麼品質下降？" | ❌ 需完整 LLM | 20% |

**總覆蓋率**: 80%

#### 成本節省計算

假設每天 100 次互動:
- 80 次可用 Skill: 80 × $0.005 = $0.40
- 20 次需完整 LLM: 20 × $0.03 = $0.60
- **每天: $1.00**
- **每月: $30**

不使用 Skills:
- 100 次完整 LLM: 100 × $0.03 = $3.00/天
- **每月: $90**

**節省: $60/月 (67%)** 🎉

---

## 8. 技術架構與選型

### 8.1 技術棧總覽

#### 前端技術棧
```
Vue.js 3 生態系統
├── Vue.js 3.3+ (Composition API)
├── Vue Router 4
├── Pinia (狀態管理)
├── Ant Design Vue 4 (UI 組件庫)
├── ECharts 5 (通用圖表)
├── D3.js v7 (自訂視覺化)
├── vis.js (網絡圖)
├── Monaco Editor (程式碼編輯)
├── Socket.io-client (WebSocket)
├── Axios (HTTP 客戶端)
└── VeeValidate + Yup (表單驗證)
```

#### 後端技術棧
```
Node.js 生態系統
├── Node.js 18+ LTS
├── Express.js 4
├── Prisma (ORM)
├── Bull (作業佇列, Redis-based)
├── node-cron (排程)
├── Socket.io (WebSocket 伺服器)
├── Winston (日誌)
├── Helmet (安全)
├── JWT (認證)
├── bcrypt (密碼加密)
└── Swagger/OpenAPI 3.0 (API 文件)
```

#### AI/ML 技術棧
```
Python 生態系統
├── FastAPI (Python API 框架)
├── Anthropic Claude SDK (LLM)
├── scikit-learn (傳統 ML)
│   ├── Isolation Forest (異常檢測)
│   └── Clustering (分類)
├── statsmodels (時間序列分析)
├── pandas (資料處理)
├── numpy (數值計算)
└── Celery (非同步任務)
```

#### 資料庫技術棧
```
資料持久層
├── PostgreSQL 14+ (主資料庫)
│   ├── dgp database (應用層)
│   └── source database (監控 clean schema)
├── Redis 6+ (快取與佇列)
└── pgvector extension (向量搜尋)
```

---

### 8.2 系統部署架構

```
┌─────────────────────────────────────────────────────────┐
│                    Load Balancer (Nginx)                 │
│                    - HTTPS Termination                   │
│                    - Rate Limiting                       │
│                    - Static Asset Caching                │
└───────────────────────────┬─────────────────────────────┘
                            │
              ┌─────────────┴─────────────┐
              │                           │
┌─────────────▼────────────┐  ┌──────────▼─────────────┐
│   Node.js Web Server     │  │  Python AI Service     │
│   (Express.js)           │  │  (FastAPI)             │
│                          │  │                        │
│   - REST API             │  │  - ML Models           │
│   - WebSocket Server     │  │  - Claude API Calls    │
│   - Skills Execution     │  │  - Data Profiling      │
│   - Session Management   │  │  - Anomaly Detection   │
│                          │  │                        │
│   PM2 Cluster Mode       │  │  Gunicorn Workers      │
│   (4 instances)          │  │  (2 workers)           │
└──────────┬───────────────┘  └────────────┬───────────┘
           │                               │
           └───────────────┬───────────────┘
                           │
            ┌──────────────┴──────────────┐
            │                             │
┌───────────▼──────────┐      ┌──────────▼────────────┐
│   PostgreSQL         │      │   Redis               │
│   (AWS RDS)          │      │   (ElastiCache)       │
│                      │      │                       │
│   - dgp database     │      │   - Session Store     │
│   - source database  │      │   - Bull Queue        │
│     (clean schema)   │      │   - Cache Layer       │
│                      │      │                       │
│   Multi-AZ           │      │   Cluster Mode        │
└──────────────────────┘      └───────────────────────┘
```

---

### 8.3 部署方案

#### 方案 A: Docker Compose (開發/小規模)

```yaml
# docker-compose.yml
version: '3.8'

services:
  web:
    build: ./web
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=postgresql://myuser:mypassword@db:5432/dgp
      - REDIS_URL=redis://redis:6379
      - CLAUDE_API_KEY=${CLAUDE_API_KEY}
    depends_on:
      - db
      - redis
      - ai-service

  ai-service:
    build: ./ai-service
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://myuser:mypassword@db:5432/dgp
      - REDIS_URL=redis://redis:6379
      - CLAUDE_API_KEY=${CLAUDE_API_KEY}

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - web

  db:
    image: postgres:14
    environment:
      - POSTGRES_USER=myuser
      - POSTGRES_PASSWORD=mypassword
      - POSTGRES_DB=dgp
    volumes:
      - pgdata:/var/lib/postgresql/data

  redis:
    image: redis:6-alpine
    volumes:
      - redisdata:/data

volumes:
  pgdata:
  redisdata:
```

#### 方案 B: Kubernetes (生產環境)

```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dgp-web
spec:
  replicas: 3
  selector:
    matchLabels:
      app: dgp-web
  template:
    metadata:
      labels:
        app: dgp-web
    spec:
      containers:
      - name: web
        image: dgp-web:latest
        ports:
        - containerPort: 3000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: dgp-secrets
              key: database-url
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: dgp-secrets
              key: redis-url
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
---
apiVersion: v1
kind: Service
metadata:
  name: dgp-web-service
spec:
  selector:
    app: dgp-web
  ports:
  - protocol: TCP
    port: 80
    targetPort: 3000
  type: LoadBalancer
```

---

### 8.4 CI/CD 流程

```yaml
# .github/workflows/deploy.yml
name: Build and Deploy

on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run tests
        run: npm test
      
      - name: Run linter
        run: npm run lint

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build Docker images
        run: |
          docker build -t dgp-web:${{ github.sha }} ./web
          docker build -t dgp-ai:${{ github.sha }} ./ai-service
      
      - name: Push to registry
        run: |
          docker push dgp-web:${{ github.sha }}
          docker push dgp-ai:${{ github.sha }}

  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to production
        run: |
          kubectl set image deployment/dgp-web \
            web=dgp-web:${{ github.sha }}
          kubectl set image deployment/dgp-ai \
            ai=dgp-ai:${{ github.sha }}
```

---

## 9. 開發計畫

### 9.1 總時程: 10 週

```
Week 1-2:  Phase 1 - 基礎架構 + Metadata 整合
Week 3-4:  Phase 2 - ETL 作業管理 + 成本追蹤
Week 5-6:  Phase 3 - 品質管理 + AI 異常檢測 + 資料剖析
Week 7:    Phase 4 - 元數據 + AI 自動生成 + Schema 演化
Week 8:    Phase 5 - 自然語言介面 + Skills 架構
Week 9:    Phase 6 - 清理 & 告警 + AI 根因分析 + 資料探索
Week 10:   Phase 7 - 測試 & 部署
```

---

### 9.2 詳細階段規劃

#### Phase 1: 基礎架構 (Week 1-2)

**目標**: 建立專案骨架與核心功能

**前端任務**:
- [x] Vue.js 3 專案初始化
  - Vite 建構工具
  - Vue Router 4 配置
  - Pinia 狀態管理
- [x] Ant Design Vue 整合
  - 主題配置
  - 全局樣式
- [x] 基礎佈局設計
  - 頂部導航列
  - 側邊選單
  - 主內容區
  - AI 助手面板（骨架）
- [x] 認證介面
  - 登入頁面
  - JWT Token 管理

**後端任務**:
- [x] Node.js + Express 專案初始化
  - 目錄結構設計
  - 環境配置
- [x] 資料庫設計
  - dgp database 建立
  - 核心表結構設計
  - Prisma Schema 定義
- [x] Metadata 整合設計
  - source database 連接配置
  - Metadata Service 架構
  - API 端點設計
- [x] JWT 認證系統
  - Token 生成與驗證
  - 權限中介層
- [x] AI Gateway 基礎
  - Claude API 整合
  - 基礎對話功能

**AI/ML 任務**:
- [x] Python FastAPI 專案初始化
- [x] Claude API 測試
- [x] 基礎 ML 環境設定

**交付物**:
- ✅ 可登入的系統骨架
- ✅ 基礎頁面佈局
- ✅ Metadata 連接測試成功
- ✅ AI 基礎對話功能

**驗收標準**:
- [ ] 使用者可以登入系統
- [ ] 可以查詢 clean schema 的 7 張 metadata 表
- [ ] AI 可以回應簡單問題
- [ ] 前後端通訊正常

---

#### Phase 2: ETL 作業管理 (Week 3-4)

**目標**: 完整的 ETL 作業管理與監控

**前端任務**:
- [x] 作業列表頁面
  - 列表/卡片/甘特圖視圖
  - 搜尋與篩選
  - 即時狀態更新（WebSocket）
- [x] 作業詳情頁面
  - 基本資訊展示
  - 執行趨勢圖（ECharts）
  - 執行歷史表格
- [x] 作業表單
  - 新增/編輯作業
  - 排程配置
  - 依賴關係設定

**後端任務**:
- [x] ETL 作業 CRUD API
  - 作業註冊
  - 作業配置管理
- [x] 作業執行引擎
  - Bull Queue 整合
  - 作業執行邏輯
  - 錯誤處理與重試
- [x] 排程管理
  - node-cron 整合
  - 排程觸發
  - 排程衝突檢測
- [x] 執行歷史追蹤
  - 執行記錄儲存
  - 日誌檔案管理
- [x] 成本追蹤基礎
  - 執行時間記錄
  - 資源使用監控

**AI/ML 任務**:
- [x] ETL 效能分析
  - 瓶頸檢測
  - 優化建議生成

**交付物**:
- ✅ ETL 作業可配置與執行
- ✅ 視覺化監控介面
- ✅ AI 效能分析功能
- ✅ 成本追蹤基礎

**驗收標準**:
- [ ] 可以新增、編輯、刪除作業
- [ ] 可以手動執行作業
- [ ] 可以設定排程自動執行
- [ ] 可以查看執行歷史與日誌
- [ ] AI 可以分析作業效能並提供建議

---

#### Phase 3: 品質管理 + AI 功能 (Week 5-6)

**目標**: 完整的品質監控與 AI 賦能

**前端任務**:
- [x] 品質總覽儀表板
  - 卡片式統計
  - 品質趨勢圖
  - 資料表分布圖
- [x] 資料表品質詳情
  - 雷達圖（品質維度）
  - 問題列表
  - 一鍵修復介面
- [x] 品質規則管理
  - 規則 CRUD
  - 規則測試工具
- [x] 資料剖析頁面
  - 統計摘要展示
  - 異常模式顯示

**後端任務**:
- [x] 品質檢查引擎
  - 整合現有 _metadata_quality_checks
  - 品質規則執行
  - 結果儲存
- [x] 品質 API
  - 查詢品質資訊
  - 查詢問題列表
  - 執行檢查
- [x] 一鍵修復功能
  - 修復方案生成
  - 修復執行
  - 結果追蹤

**AI/ML 任務**:
- [x] 異常檢測模型
  - Isolation Forest 訓練
  - 異常檢測 API
- [x] 品質預測模型
  - 時間序列分析
  - 預測 API
- [x] 自動規則推薦
  - 模式挖掘
  - 規則生成
- [x] 資料剖析
  - 統計分析
  - 模式識別
  - 異常識別

**交付物**:
- ✅ 品質監控系統
- ✅ 問題追蹤與修復
- ✅ AI 異常檢測
- ✅ AI 品質預測
- ✅ AI 規則推薦
- ✅ 資料剖析功能

**驗收標準**:
- [ ] 可以查看整體品質狀態
- [ ] 可以深入分析單一資料表品質
- [ ] 可以配置品質規則
- [ ] AI 可以自動檢測異常
- [ ] AI 可以預測品質趨勢
- [ ] AI 可以推薦規則
- [ ] 一鍵修復功能可用
- [ ] 資料剖析報告完整

---

#### Phase 4: 元數據 + AI 功能 (Week 7)

**目標**: 元數據管理與 AI 賦能

**前端任務**:
- [x] 元數據瀏覽器
  - 資料表列表
  - 欄位列表
  - 搜尋與篩選
- [x] 資料血緣圖
  - D3.js 互動式圖
  - 桑基圖（欄位級）
  - 節點詳情面板
- [x] 欄位管理頁面
  - 欄位 CRUD
  - AI 自動生成介面

**後端任務**:
- [x] 元數據 API
  - 查詢資料表
  - 查詢欄位
  - 查詢血緣
  - 更新元數據
- [x] 血緣追蹤
  - 遞迴查詢上下游
  - 圖形資料轉換
- [x] Schema 演化追蹤
  - Schema 比對
  - 變更檢測
  - 影響分析

**AI/ML 任務**:
- [x] 自動元數據生成
  - LLM 生成欄位描述
  - 業務分類
- [x] 智能血緣推斷
  - SQL 解析
  - 血緣推斷
- [x] 自動標籤分類
  - 語意分類
  - 標籤推薦
- [x] Schema 演化管理
  - 變更影響分析
  - 遷移腳本生成

**交付物**:
- ✅ 元數據管理系統
- ✅ 血緣可視化
- ✅ AI 元數據生成
- ✅ AI 血緣推斷
- ✅ Schema 演化管理

**驗收標準**:
- [ ] 可以瀏覽所有資料表與欄位
- [ ] 可以查看資料血緣圖
- [ ] 可以編輯元數據
- [ ] AI 可以自動生成欄位描述
- [ ] AI 可以推斷血緣關係
- [ ] 可以追蹤 Schema 變更

---

#### Phase 5: 自然語言介面 + Skills (Week 8)

**目標**: 完整的 AI 對話與 Skills 架構

**前端任務**:
- [x] AI 助手面板（完整版）
  - 對話介面
  - 快速操作
  - 歷史記錄
  - 快捷鍵 (Ctrl+K)
- [x] 智能查詢頁面
  - 自然語言輸入
  - 對話歷史
  - 視覺化結果展示

**後端任務**:
- [x] AI Gateway（完整版）
  - 意圖識別
  - 上下文管理
  - 對話歷史儲存
- [x] Skills 架構
  - Skills 註冊表
  - Skills Router
  - Skills 執行引擎
- [x] 核心 Skills 開發
  - quality_check (3個函數)
  - metadata_query (4個函數)
  - etl_operations (4個函數)
- [x] 自然語言轉 SQL
  - SQL 生成
  - 查詢執行
  - 結果格式化

**AI/ML 任務**:
- [x] 意圖識別模型
  - 輕量級意圖分類
  - Skills 匹配
- [x] 上下文管理
  - 對話歷史管理
  - 上下文相關性判斷
- [x] 自然語言理解
  - 複雜查詢理解
  - 參數提取

**交付物**:
- ✅ 自然語言介面
- ✅ 對話式操作
- ✅ Skills 架構
- ✅ 核心 Skills (11個函數)
- ✅ AI 主動建議

**驗收標準**:
- [ ] 可以用自然語言查詢系統
- [ ] AI 可以理解複雜查詢
- [ ] Skills 可以節省 50%+ Token
- [ ] AI 可以執行操作（經確認）
- [ ] AI 可以主動提供建議
- [ ] 快捷鍵可以快速呼叫 AI

**Token 節省目標**: 達成 60% 覆蓋率

---

#### Phase 6: 清理 & 告警 + 進階 AI (Week 9)

**目標**: 資料清理與智能告警 + 進階 AI 功能

**前端任務**:
- [x] 清理規則管理
  - 規則 CRUD
  - 規則測試
- [x] 清理日誌查詢
  - 日誌列表
  - 清理前後對比
- [x] 告警管理
  - 告警規則配置
  - 告警列表
  - 告警處理
- [x] 資料探索頁面
  - 探索報告展示
  - 洞察視覺化

**後端任務**:
- [x] 清理規則 CRUD API
- [x] 清理執行引擎
  - 整合現有 _cleansing_log
  - 規則執行
- [x] 清理日誌 API
  - 日誌查詢
  - 統計分析
- [x] 告警規則引擎
  - 規則配置
  - 觸發檢測
- [x] 告警通知
  - WebSocket 推送
  - 系統通知
- [x] 進階 Skills 開發
  - data_profiling (2個函數)
  - data_exploration (2個函數)
  - cost_analysis (2個函數)

**AI/ML 任務**:
- [x] 自動學習清理模式
  - 模式挖掘
  - 規則自動化
- [x] 告警智能過濾
  - 告警聚類
  - 根因識別
- [x] 根因分析引擎
  - 日誌分析
  - 因果推斷
- [x] 資料探索與洞察
  - 統計分析
  - 關聯規則挖掘
  - 模式發現
- [x] 智能成本優化
  - 成本歸因分析
  - 優化建議

**交付物**:
- ✅ 清理規則系統
- ✅ 智能告警系統
- ✅ 根因分析引擎
- ✅ 資料探索功能
- ✅ 成本優化分析
- ✅ 進階 Skills (6個函數)

**驗收標準**:
- [ ] 可以配置清理規則
- [ ] 可以查詢清理日誌
- [ ] AI 可以學習清理模式
- [ ] 可以配置告警規則
- [ ] AI 可以智能過濾告警
- [ ] AI 可以自動根因分析
- [ ] AI 可以發現資料洞察
- [ ] AI 可以提供成本優化建議
- [ ] Skills 覆蓋率達到 80%

---

#### Phase 7: 測試 & 部署 (Week 10)

**目標**: 測試、優化、部署

**測試任務**:
- [x] 單元測試
  - 後端 API 測試
  - Skills 函數測試
  - AI 功能測試
- [x] 整合測試
  - E2E 測試（Playwright）
  - API 整合測試
  - WebSocket 測試
- [x] 效能測試
  - 負載測試
  - 壓力測試
  - Token 消耗測試
- [x] 使用者測試
  - UI/UX 測試
  - 可用性測試

**優化任務**:
- [x] 前端優化
  - 程式碼分割
  - 懶加載
  - 快取優化
- [x] 後端優化
  - 查詢優化
  - API 快取
  - 連接池調優
- [x] AI 優化
  - Skills 覆蓋率提升
  - Prompt 優化
  - Token 節省驗證

**部署任務**:
- [x] Docker 容器化
  - Dockerfile 編寫
  - docker-compose.yml
- [x] CI/CD 建立
  - GitHub Actions
  - 自動化測試
  - 自動化部署
- [x] 監控設定
  - Prometheus + Grafana
  - 日誌收集
  - 告警配置

**文件任務**:
- [x] 使用者手冊
  - 功能說明
  - 操作指南
- [x] 管理員手冊
  - 部署指南
  - 維護手冊
- [x] 開發者文件
  - API 文件
  - Skills 開發指南
- [x] 交接文件
  - 架構說明
  - 問題排查

**交付物**:
- ✅ 生產就緒系統
- ✅ 完整測試報告
- ✅ 部署方案
- ✅ 完整文件

**驗收標準**:
- [ ] 所有測試通過
- [ ] 效能符合指標
- [ ] Token 節省達到 50%+
- [ ] 部署成功且穩定運行
- [ ] 文件完整且清晰
- [ ] 使用者可以獨立使用系統

---

### 9.3 開發資源需求

#### 人力資源
- **全端工程師**: 1 人（Vue.js + Node.js + Python）
- **工作時間**: 全職 10 週

#### 技能要求
- ✅ Vue.js 3 (Composition API)
- ✅ Node.js + Express.js
- ✅ PostgreSQL + Prisma
- ✅ Python + FastAPI
- ✅ AI/ML 基礎（scikit-learn, statsmodels）
- ✅ LLM 整合（Claude API）
- ✅ Docker + CI/CD

---

## 10. 成本分析

### 10.1 開發成本

#### 人力成本
假設全端工程師月薪 NTD 80,000：
- 10 週 = 2.5 個月
- **總成本**: NTD 200,000

#### 其他開發成本
- 開發環境 AWS: NTD 5,000
- Claude API 測試: NTD 3,000
- 工具與授權: NTD 2,000
- **小計**: NTD 10,000

**開發總成本**: NTD 210,000 (約 USD 7,000)

---

### 10.2 運行成本（月）

#### 基礎設施成本

| 項目 | 規格 | 費用 (USD) |
|------|------|-----------|
| **AWS RDS PostgreSQL** | db.t3.medium (已有) | $0 |
| **AWS ElastiCache Redis** | cache.t3.small | $20 |
| **AWS EC2 (Web)** | t3.medium × 1 | $30 |
| **AWS EC2 (AI Service)** | t3.small × 1 | $15 |
| **Load Balancer** | Application LB | $18 |
| **資料傳輸** | 約 100GB/月 | $9 |
| **備份 & 儲存** | 50GB S3 | $2 |
| **小計** | | **$94** |

#### AI 服務成本

| 項目 | 用量 | 單價 | 費用 (USD) |
|------|------|------|-----------|
| **Claude API (意圖識別)** | 6M tokens/月 | $0.003/1K | $18 |
| **Claude API (完整對話)** | 600K tokens/月 | $0.015/1K | $9 |
| **總 Input tokens** | 6.6M/月 | | $27 |
| **Output tokens** | 1.5M/月 | $0.075/1K | $113 |
| **小計** | | | **$140** |

**註**: 使用 Skills 後，預估節省 50% = **$70**

#### 其他成本
- 監控工具 (Grafana Cloud): $0 (免費層)
- SSL 憑證: $0 (Let's Encrypt)
- 域名: $1/月

**月運行總成本**: $94 + $70 + $1 = **$165** (約 NTD 5,000)

---

### 10.3 成本節省分析

#### Token 節省（使用 Skills）

**不使用 Skills**:
- 假設每天 100 次互動
- 平均每次 2,500 tokens input + 500 tokens output
- Input: 100 × 2,500 = 250K tokens/天 = 7.5M tokens/月
- Output: 100 × 500 = 50K tokens/天 = 1.5M tokens/月
- 成本: (7.5M × $0.015) + (1.5M × $0.075) = **$112.5 + $112.5 = $225/月**

**使用 Skills (80% 覆蓋率)**:
- 80 次簡單查詢（用 Skills）:
  - Input: 200 tokens × 80 × 30 = 480K tokens/月
  - Output: 100 tokens × 80 × 30 = 240K tokens/月
  - 成本: (480K × $0.003) + (240K × $0.075) = $1.4 + $18 = $19.4
- 20 次複雜分析（用完整 LLM）:
  - Input: 2,500 tokens × 20 × 30 = 1.5M tokens/月
  - Output: 1,000 tokens × 20 × 30 = 600K tokens/月
  - 成本: (1.5M × $0.015) + (600K × $0.075) = $22.5 + $45 = $67.5
- **總成本**: $19.4 + $67.5 = **$86.9/月**

**節省**: $225 - $87 = **$138/月 (61%)**

實際估算採用 $70/月（保守估計）

---

### 10.4 ROI 分析

#### 直接效益（時間節省）

假設系統節省運維時間：
- 日常監控: 1 小時/天 → 10 分鐘/天（節省 50 分鐘）
- 問題排查: 2 小時/週 → 20 分鐘/週（節省 1.7 小時）
- 品質檢查: 3 小時/週 → 30 分鐘/週（節省 2.5 小時）
- 元數據維護: 4 小時/月 → 30 分鐘/月（節省 3.5 小時）
- ETL 優化: 8 小時/月 → 1 小時/月（節省 7 小時）

**每月節省時間**: 
- (50分鐘 × 22天) + (1.7小時 × 4週) + (2.5小時 × 4週) + 3.5小時 + 7小時
- ≈ 18 + 7 + 10 + 3.5 + 7 = **45.5 小時/月**

**時間價值**（假設工程師時薪 NTD 500）:
- 45.5 小時 × NTD 500 = **NTD 22,750/月** (約 USD 750)

#### 間接效益
- 資料品質提升 8.8% → 減少錯誤決策成本
- 問題發現時間減少 95% → 降低業務中斷風險
- ETL 效能提升 40-65% → 降低基礎設施成本

**保守估計間接效益**: NTD 10,000/月 (USD 330)

#### ROI 計算

**月度效益**: USD 750 + 330 = **USD 1,080**  
**月度成本**: **USD 165**  
**月淨效益**: USD 915

**投資回報**:
- 開發成本: USD 7,000
- 回本時間: 7,000 ÷ 915 = **7.7 個月**
- **年度 ROI**: (915 × 12) ÷ 7,000 = **157%**

---

### 10.5 成本優化建議

#### 短期優化（立即可做）
1. **使用 Reserved Instances**（AWS）
   - 節省: 30-40% 基礎設施成本
   - 節省金額: ~$30/月

2. **優化 Claude API 使用**
   - 提升 Skills 覆蓋率到 85%
   - 節省: 額外 $10-15/月

3. **實施智能快取**
   - 減少重複查詢
   - 節省: $5-10/月

**短期總節省**: ~$45-55/月

#### 長期優化（3-6 個月後）
1. **自建輕量級模型**
   - 意圖識別用自建模型
   - 節省: $15-20/月

2. **資料分區與歸檔**
   - 減少資料庫儲存成本
   - 節省: $10/月

3. **負載優化**
   - 根據實際使用調整資源
   - 節省: $20-30/月

**長期總節省**: ~$45-60/月

**優化後月成本**: $165 - $55 = **$110/月**  
**優化後 ROI**: (1,080 - 110) × 12 ÷ 7,000 = **166%**

---

## 11. 成功指標

### 11.1 功能性指標

#### 系統功能
- ✅ 支援管理 100+ ETL 作業
- ✅ 元數據覆蓋率 100%
- ✅ 支援 5+ 種資料源類型
- ✅ AI 功能覆蓋率 100%（14 大功能）
- ✅ Skills 覆蓋率 ≥ 80%

#### AI 效能
- ✅ AI 查詢準確率 ≥ 95%
- ✅ 意圖識別準確率 ≥ 90%
- ✅ 自動規則推薦準確率 ≥ 85%
- ✅ 異常檢測準確率 ≥ 80%
- ✅ 一鍵修復成功率 ≥ 90%

---

### 11.2 效能指標

#### 系統效能
- ⚡ 頁面載入時間 < 2 秒（首次）
- ⚡ 頁面載入時間 < 0.5 秒（快取後）
- ⚡ API 回應時間 < 500ms (P95)
- ⚡ API 回應時間 < 200ms (P50)
- ⚡ WebSocket 延遲 < 100ms

#### AI 回應效能
- ⚡ Skills 查詢回應 < 2 秒
- ⚡ 完整 LLM 查詢回應 < 5 秒
- ⚡ 意圖識別時間 < 500ms

#### 系統可用性
- 🔒 系統可用性 ≥ 99.5%
- 🔒 告警回應時間 < 1 分鐘
- 🔒 資料同步延遲 < 5 分鐘

---

### 11.3 使用者體驗指標

#### 易用性
- 😊 新使用者上手時間 < 30 分鐘
- 😊 常用操作步驟 ≤ 3 步
- 😊 AI 助手使用率 ≥ 60%
- 😊 自然語言查詢使用率 ≥ 40%

#### 操作效率
- 📈 操作時間縮短 85%（vs 手動）
- 📈 問題發現時間縮短 95%
- 📈 問題解決時間縮短 80%

#### 使用者滿意度（問卷）
- 😊 整體滿意度 ≥ 4.0/5.0
- 😊 介面易用性 ≥ 4.2/5.0
- 😊 AI 助手滿意度 ≥ 4.5/5.0
- 😊 功能完整性 ≥ 4.0/5.0

---

### 11.4 業務價值指標

#### 時間節省
- ⏱️ 日常運維時間減少 85%
- ⏱️ 品質檢查時間減少 90%
- ⏱️ 元數據維護時間減少 92%
- ⏱️ 問題排查時間減少 83%

#### 品質提升
- 📊 資料品質評分提升 +8.8%
- 📊 問題發現率提升 +300%（主動發現）
- 📊 告警精準度提升 +85%（減少誤報）
- 📊 ETL 成功率提升 +15%

#### 成本節省
- 💰 運維人力成本節省 45 小時/月
- 💰 AI API 成本節省 61%（vs 不用 Skills）
- 💰 ETL 執行成本節省 37%（優化後）
- 💰 總 ROI: 157%+

---

### 11.5 技術指標

#### 程式碼品質
- ✅ 測試覆蓋率 ≥ 80%
- ✅ 程式碼審查通過率 100%
- ✅ 重大 Bug 數量 = 0
- ✅ 技術債務合理（< 10%）

#### 可維護性
- 🔧 平均修復時間 (MTTR) < 2 小時
- 🔧 部署頻率 ≥ 1 次/週
- 🔧 部署失敗率 < 5%
- 🔧 回滾時間 < 10 分鐘

---

## 12. 風險評估

### 12.1 技術風險

| 風險 | 嚴重性 | 可能性 | 影響 | 緩解措施 |
|------|--------|--------|------|----------|
| **跨資料庫查詢效能問題** | 高 | 中 | 查詢緩慢 | • 使用 API 層統一存取<br>• 實施快取策略<br>• 查詢優化 |
| **大量資料處理瓶頸** | 中 | 高 | 系統卡頓 | • 非同步處理<br>• 分批處理<br>• 進度顯示 |
| **WebSocket 連線穩定性** | 中 | 中 | 即時更新失效 | • 心跳機制<br>• 自動重連<br>• 降級到輪詢 |
| **AI API 限流/故障** | 高 | 低 | AI 功能不可用 | • 降級機制<br>• 快取回應<br>• 備用 API |
| **Skills 覆蓋率不足** | 低 | 中 | Token 成本較高 | • 持續新增 Skills<br>• 分析高頻查詢<br>• 優化 Prompt |
| **異常檢測誤報** | 中 | 中 | 使用者困擾 | • 調整閾值<br>• 使用者回饋<br>• 持續訓練 |

---

### 12.2 專案風險

| 風險 | 嚴重性 | 可能性 | 影響 | 緩解措施 |
|------|--------|--------|------|----------|
| **需求變更頻繁** | 中 | 高 | 時程延誤 | • 敏捷開發<br>• 模組化設計<br>• 變更管理流程 |
| **時程延誤** | 中 | 中 | 上線延後 | • 優先核心功能<br>• 並行開發<br>• 彈性緩衝時間 |
| **資源不足** | 高 | 低 | 無法完成 | • 使用成熟框架<br>• 減少自建輪子<br>• 外包部分工作 |
| **關鍵人員離職** | 高 | 低 | 專案停滯 | • 完整文件<br>• 知識分享<br>• 程式碼審查 |
| **整合困難** | 中 | 中 | 功能受限 | • 早期驗證整合<br>• POC 測試<br>• 備用方案 |

---

### 12.3 業務風險

| 風險 | 嚴重性 | 可能性 | 影響 | 緩解措施 |
|------|--------|--------|------|----------|
| **使用者接受度低** | 中 | 低 | 使用率低 | • 使用者參與設計<br>• 培訓與支援<br>• 漸進式導入 |
| **AI 建議不準確** | 中 | 中 | 信任度下降 | • 顯示信心度<br>• 人工覆蓋<br>• 持續優化 |
| **資料安全問題** | 高 | 低 | 合規風險 | • 權限控制<br>• 資料加密<br>• 審計日誌 |
| **成本超支** | 中 | 中 | 預算超標 | • 嚴格監控<br>• 成本優化<br>• 彈性方案 |

---

### 12.4 風險監控與應對

#### 每週風險審查
- 檢視風險清單
- 評估風險變化
- 調整緩解措施

#### 風險觸發條件
| 風險 | 觸發條件 | 立即行動 |
|------|---------|---------|
| 效能問題 | P95 延遲 > 1秒 | 效能優化衝刺 |
| Token 成本超標 | 超過預算 20% | 檢討 Skills 覆蓋率 |
| 時程延誤 | 延誤 > 3 天 | 調整優先級 |
| 品質問題 | 重大 Bug > 2 | 停止新功能開發 |

---

## 13. 附錄

### 13.1 參考文件

#### 已產生的文件（2026-02-13）
- `data_governance_platform_spec_20260209.md` - 原始規格書
- `dgp_ai_capabilities_supplement_20260213.md` - AI 功能補充
- `dgp_ai_integration_options_20260213.md` - 整合方案分析
- `dgp_final_specification_20260213.md` - 最終規格（Web-only）
- `dgp_optimization_analysis_20260213.md` - 優化分析

#### 相關技術文件
- [Vue.js 3 Documentation](https://vuejs.org/)
- [Ant Design Vue](https://antdv.com/)
- [Express.js Guide](https://expressjs.com/)
- [Prisma Documentation](https://www.prisma.io/docs/)
- [Anthropic Claude API](https://docs.anthropic.com/)
- [scikit-learn User Guide](https://scikit-learn.org/stable/user_guide.html)
- [D3.js Documentation](https://d3js.org/)

---

### 13.2 術語表

| 術語 | 英文 | 說明 |
|------|------|------|
| 資料治理 | Data Governance | 管理資料資產的政策、流程與標準 |
| 資料血緣 | Data Lineage | 追蹤資料的來源與流向 |
| ETL | Extract, Transform, Load | 資料抽取、轉換、載入 |
| 資料品質 | Data Quality | 衡量資料的準確性、完整性、一致性等 |
| 元數據 | Metadata | 描述資料的資料 |
| Skills | Skills | 預定義的查詢/操作邏輯，用於節省 Token |
| Medallion Architecture | Medallion Architecture | 分層資料架構（Source/Clean/Mart） |
| 異常檢測 | Anomaly Detection | 識別不符合正常模式的資料 |
| 根因分析 | Root Cause Analysis | 追溯問題的根本原因 |
| LLM | Large Language Model | 大型語言模型（如 Claude） |
| Token | Token | LLM 計費單位 |
| 意圖識別 | Intent Recognition | 理解使用者的意圖 |
| 資料剖析 | Data Profiling | 分析資料的統計特徵 |

---

### 13.3 聯絡資訊

**專案負責人**: Irene  
**開發團隊**: meimei (AI Assistant)  
**技術支援**: 待指定  

**緊急聯絡**: 待補充

---

## 14. 版本歷史

| 版本 | 日期 | 變更內容 | 作者 |
|------|------|---------|------|
| 1.0 | 2026-02-09 | 初版規格書 | meimei |
| 1.1 | 2026-02-13 | 新增 AI 賦能功能補充 | meimei |
| 1.2 | 2026-02-13 | 確認 Web-only 方案 | meimei |
| 1.3 | 2026-02-13 | 新增 Metadata 整合與 Skills | meimei |
| **2.0** | **2026-02-14** | **完整整合版規格書** | **meimei** |

---

## 15. 總結

### 15.1 核心價值

**DGP 資料治理管理平台**是一個：
- 🎯 **統一的** Web-based 資料治理平台
- 🤖 **AI 驅動**的智能管理系統
- 💰 **高 ROI** 的投資（157%+ 年度回報）
- 🚀 **高效能**的運維工具（節省 85% 時間）

### 15.2 關鍵特色

1. **完整 AI 賦能**（14 大 AI 功能）
   - 從被動響應到主動預警
   - 從手動操作到智能自動化

2. **自然語言介面**
   - 降低 90% 使用門檻
   - 對話式操作體驗

3. **Skills 架構**
   - 節省 61% AI API 成本
   - 80% 查詢覆蓋率

4. **完整 Metadata 整合**
   - 7 張元數據表完整納入
   - 即時血緣追蹤

5. **可視化優先**
   - 複雜資料簡單呈現
   - 一眼看出問題

### 15.3 預期成果

#### 3 個月後
- ✅ 系統上線運行
- ✅ 核心功能完整
- ✅ AI 功能可用
- ✅ 使用者開始使用

#### 6 個月後
- ✅ 運維時間減少 85%
- ✅ 資料品質提升 8.8%
- ✅ 開發成本回本
- ✅ 使用者滿意度 ≥ 4.0/5.0

#### 12 個月後
- ✅ 年度 ROI 達 157%+
- ✅ Skills 覆蓋率 ≥ 85%
- ✅ 系統穩定成熟
- ✅ 擴展到更多資料源

### 15.4 下一步行動

請確認：
- [ ] 規格書內容完整且符合需求
- [ ] 技術選型無異議
- [ ] 開發時程（10 週）可接受
- [ ] 成本預算（開發 $7K + 運行 $165/月）可接受
- [ ] 準備開始開發

**確認後即可開始 Phase 1 開發！** 🚀

---

## 📝 規格書完成確認

**文件名稱**: DGP_Complete_Specification_v2.0.md  
**總頁數**: 約 150 頁（3,500+ 行）  
**總字數**: 約 68,000 字  
**完成日期**: 2026-02-14  

**涵蓋範圍**:
- ✅ 專案概述與目標
- ✅ 核心設計原則（3 大原則）
- ✅ 系統架構（完整技術棧）
- ✅ AI 賦能功能（14 大功能詳細說明）
- ✅ 核心功能模組（5 大模組 + UI 設計）
- ✅ Metadata 整合方案（7 張表完整納入）
- ✅ Skills 架構設計（節省 61% Token）
- ✅ 技術架構與選型
- ✅ 開發計畫（10 週 7 階段詳細規劃）
- ✅ 成本分析（開發 + 運行 + ROI）
- ✅ 成功指標（功能/效能/使用者/業務/技術）
- ✅ 風險評估（技術/專案/業務風險）
- ✅ 附錄（參考文件、術語表、版本歷史）

**規格書已完成！** ✨

---

**END OF DOCUMENT**